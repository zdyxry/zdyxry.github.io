<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Python logging 最佳实践-译 | Yiran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Python Logging 最佳实践 背景最近在工作中要新增一个服务，需要处理服务日志，之前每次使用 logging 都是很简单的配置，没有了解过最佳实践， google 到了 fangpenlin 写的一篇博客（https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/），很受用，因此翻译过来便于自己以后回顾">
<meta name="keywords" content="Python,logging">
<meta property="og:type" content="article">
<meta property="og:title" content="Python logging 最佳实践-译">
<meta property="og:url" content="http://zdyxry.com/2018/07/22/译-python-logging-最佳实践/index.html">
<meta property="og:site_name" content="Yiran">
<meta property="og:description" content="Python Logging 最佳实践 背景最近在工作中要新增一个服务，需要处理服务日志，之前每次使用 logging 都是很简单的配置，没有了解过最佳实践， google 到了 fangpenlin 写的一篇博客（https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/），很受用，因此翻译过来便于自己以后回顾">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-22T01:52:49.106Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python logging 最佳实践-译">
<meta name="twitter:description" content="Python Logging 最佳实践 背景最近在工作中要新增一个服务，需要处理服务日志，之前每次使用 logging 都是很简单的配置，没有了解过最佳实践， google 到了 fangpenlin 写的一篇博客（https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/），很受用，因此翻译过来便于自己以后回顾">
  
    <link rel="alternate" href="/atom.xml" title="Yiran" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-136220198-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Yiran</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zdyxry.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-译-python-logging-最佳实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/22/译-python-logging-最佳实践/" class="article-date">
  <time datetime="2018-07-22T01:50:47.000Z" itemprop="datePublished">2018-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Python logging 最佳实践-译
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Python Logging 最佳实践</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近在工作中要新增一个服务，需要处理服务日志，之前每次使用 logging 都是很简单的配置，没有<br>了解过最佳实践， google 到了 fangpenlin 写的一篇博客（<a href="https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/），" target="_blank" rel="noopener">https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/），</a><br>很受用，因此翻译过来便于自己以后回顾使用，也希望大家能够正确配置日志，对运维同学友好些~</p>
<h2 id="Good-Logging-practice-in-Python"><a href="#Good-Logging-practice-in-Python" class="headerlink" title="Good Logging practice in Python"></a>Good Logging practice in Python</h2><p>在显示中，日志是重要的。当你在转账时，它们是转账记录。当飞机起飞时，黑匣子会记录所有事情。<br>如果某些事情发生了错误，人们可以通过阅读日志有机会弄清楚发生了什么。同样，在系统开发、排查<br>和运行中日志也是重要的。当你编写了一个服务，日志就是必须品。如果没有日志，我几乎不可能发现<br>错误如果服务已经挂掉。不仅仅是服务，日志对于桌面应用也是重要的。举个例子，当你的程序在你<br>客户电脑崩溃了，你可以让他们发送日志文件给你，你才有可能去查找为什么崩溃。相信我，你永远<br>不知道在不同的电脑环境中会发生什么奇怪的问题.</p>
<h2 id="Print-不是个好主意"><a href="#Print-不是个好主意" class="headerlink" title="Print 不是个好主意"></a>Print 不是个好主意</h2><p>尽管日志很重要，但是不是所有的开发者都知道如何正确的使用。我见过一些开发者在开发过程中插入<br>一些 print ，在开发结束时删除这些 print。向下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> <span class="string">'Start reading database'</span></span><br><span class="line">records = model.read_recrods()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'# records'</span>, records</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Updating record ...'</span></span><br><span class="line">model.update_records(records)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'done'</span></span><br></pre></td></tr></table></figure>
<p>当程序是一个简单的脚本时这是工作的，但是对于一个复杂的系统，你最好不要通过这种途径记录日志。<br>第一，你在日志中无法记录重要的信息，你可能看到很多垃圾信息在日志中，但是没有找到任何有用的。<br>你也不能通过不修改代码的方式控制日志的输出，还有可能在不使用这些 print 的时候忘记删除掉。<br>所有的 print 信息都将输出到标准输出中，这个是要禁止的。当然你可以输出到标准错误输出中，但是<br>这仍不是记录日志的最佳实践。</p>
<h2 id="使用-Python-标准库-Logging"><a href="#使用-Python-标准库-Logging" class="headerlink" title="使用 Python 标准库 Logging"></a>使用 Python 标准库 Logging</h2><p>所以，如何正确的记录日志？ 很简单，使用标准库中的 logging 模块。感谢 Python 社区，logging<br>在标准库中，它被设计的灵活且易用。你可以使用 logging 像下面这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'Start reading database'</span>)</span><br><span class="line"><span class="comment"># read database here</span></span><br><span class="line">records = &#123;<span class="string">'john'</span>: <span class="number">55</span>, <span class="string">'tom'</span>: <span class="number">66</span>&#125;</span><br><span class="line">logger.debug(<span class="string">'Records: %s'</span>, records)</span><br><span class="line">logger.info(<span class="string">'Updating records ...'</span>)</span><br><span class="line"><span class="comment"># update records here</span></span><br><span class="line">logger.info(<span class="string">'Finish updating records'</span>)</span><br></pre></td></tr></table></figure>
<p>你可以运行得到下面输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INFO:__main__:Start reading database</span><br><span class="line">INFO:__main__:Updating records ...</span><br><span class="line">INFO:__main__:Finish updating records</span><br></pre></td></tr></table></figure>
<p>你可能会问这与 print 有什么区别。这样做当然是有好处的：</p>
<ul>
<li>你可以控制信息级别，过滤掉不重要的信息</li>
<li>你可以决定之后输出的位置和方式</li>
</ul>
<p>有不同的日志级别你可以使用：debug，info，warning，error 和 critical。<br>通过设置不同的日志级别，你可以只输出错误信息到指定的日志文件中，或者在 debug<br>时输出调试的详细信息。尝试改变日志级别为 debug 再观察下输出结果：</p>
<p><code>logging.basicConfig(level=logging.DEBUG)</code></p>
<p>输出结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INFO:__main__:Start reading database</span><br><span class="line">DEBUG:__main__:Records: &#123;<span class="string">'john'</span>: <span class="number">55</span>, <span class="string">'tom'</span>: <span class="number">66</span>&#125;</span><br><span class="line">INFO:__main__:Updating records ...</span><br><span class="line">INFO:__main__:Finish updating records</span><br></pre></td></tr></table></figure>
<p>像你所看到的那样，我们调整日志级别为 DEBUG，调试记录输出在日志中。你也可以决定<br>如何处理这些信息.举个例子你可以使用 FileHandler 让日志输出到一个文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a file handler</span></span><br><span class="line">handler = logging.FileHandler(<span class="string">'hello.log'</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a logging format</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the handlers to the logger</span></span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'Hello baby'</span>)</span><br></pre></td></tr></table></figure>
<p>有很多种不同的处理方式，你可以发送日志到你的消息中心，甚至是一个远端的服务器。<br>你也可以自定义日志处理方式，更多信息可以参考： Basic Tutorial, Advanced Tutorial and Logging Cookbook.</p>
<h2 id="设置正确的日志级别"><a href="#设置正确的日志级别" class="headerlink" title="设置正确的日志级别"></a>设置正确的日志级别</h2><p>由于 logging 的灵活性，你可以在任何地方配置适当的日志级别去记录日志，可以再之后配置他们。<br>你可能会问，什么是正确的日志级别，这里我将分享我的经验。</p>
<p>在大多数场景下，在日志中不希望去看到大量的详细信息。因此，debug 级别只是在你<br>调试过程中开启。我只使用调试级别来获取详细的调试信息，特别是当数据量很大或者频率<br>很高的时候，比如在一个 for 循环中记录某些内部的状态变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">complex_algorithm</span><span class="params">(items)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i, item <span class="keyword">in</span> enumerate(items):</span><br><span class="line">        <span class="comment"># do some complex algorithm computation</span></span><br><span class="line">        logger.debug(<span class="string">'%s iteration, item=%s'</span>, i, item)</span><br></pre></td></tr></table></figure>
<p>对于一般日志我使用 info 级别，比如，处理请求或者服务状态变化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_request</span><span class="params">(request)</span>:</span></span><br><span class="line">    logger.info(<span class="string">'Handling request %s'</span>, request)</span><br><span class="line">    <span class="comment"># handle request here</span></span><br><span class="line">    result = <span class="string">'result'</span></span><br><span class="line">    logger.info(<span class="string">'Return result: %s'</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_service</span><span class="params">()</span>:</span></span><br><span class="line">    logger.info(<span class="string">'Starting service at port %s ...'</span>, port)</span><br><span class="line">    service.start()</span><br><span class="line">    logger.info(<span class="string">'Service is started'</span>)</span><br></pre></td></tr></table></figure>
<p>当一个状态比较重要，但是又没有处于 error 状态时，我会使用 warning ，比如<br>当一个用户登录时使用了错误的密码或者连接很慢时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(user_name, password, ip_address)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> user_name != USER_NAME <span class="keyword">and</span> password != PASSWORD:</span><br><span class="line">        logger.warn(<span class="string">'Login attempt to %s from IP %s'</span>, user_name, ip_address)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="comment"># do authentication here</span></span><br></pre></td></tr></table></figure>
<p>当某些事情出现了错误，我使用 error 级别，比如抛出异常，I/O 操作失败或者连接失败：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_by_id</span><span class="params">(user_id)</span>:</span></span><br><span class="line">    user = db.read_user(user_id)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        logger.error(<span class="string">'Cannot find user with user_id=%s'</span>, user_id)</span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line">    <span class="keyword">return</span> user</span><br></pre></td></tr></table></figure>
<p>我很少使用严重级别，你可以在某些事情真的发生时，你可以使用它。比如内存泄露,<br>磁盘空间不足.</p>
<h2 id="使用-name-作为-logger-名称"><a href="#使用-name-作为-logger-名称" class="headerlink" title="使用 name 作为 logger 名称"></a>使用 <strong>name</strong> 作为 logger 名称</h2><p>你不需要讲 logger 名称设置为 <strong>name</strong> ，但是如果这样做，会带来一些好处。<br><strong>name</strong> 变量在 Python 中是当前模块名称。举个例子，你可以调用<br>logger.getLogger(<strong>name</strong>) 在模块 “foo.bar.my_module”中，这相当于<br>logger.getLogger(foo.bar.my_module)。当你需要配置 logger，你可以配置为 “foo”，<br>这样所有在 foo 包中的模块都共享同样的配置。你可以在阅读日志的时候了解模块信息。</p>
<h2 id="捕获异常并使用-traceback-记录"><a href="#捕获异常并使用-traceback-记录" class="headerlink" title="捕获异常并使用 traceback 记录"></a>捕获异常并使用 traceback 记录</h2><p>记录哪些地方出错总是一个好的做法，但是如果没有 traceback 这用处很小。你应该捕获<br>异常并与 traceback 一起记录他们。像这个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    open(<span class="string">'/path/to/does/not/exist'</span>, <span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">except</span> (SystemExit, KeyboardInterrupt):</span><br><span class="line">    <span class="keyword">raise</span></span><br><span class="line"><span class="keyword">except</span> Exception, e:</span><br><span class="line">    logger.error(<span class="string">'Failed to open file'</span>, exc_info=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>通过 exc_info=True 参数调用 logger 方法，traceback 会被记录到日志中，你可以<br>看到这样的结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR:__main__:Failed to open file</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"example.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    open(<span class="string">'/path/to/does/not/exist'</span>, <span class="string">'rb'</span>)</span><br><span class="line">IOError: [Errno <span class="number">2</span>] No such file <span class="keyword">or</span> directory: <span class="string">'/path/to/does/not/exist'</span></span><br></pre></td></tr></table></figure>
<p>你也可以调用 logger.Exception(msg, <em>args)，这相当于 logger.error(msg,exc_info=True,</em>args)。</p>
<h2 id="除非-disable-existing-loggers-False，否则不要在模块级别获取-logger"><a href="#除非-disable-existing-loggers-False，否则不要在模块级别获取-logger" class="headerlink" title="除非 disable_existing_loggers == False，否则不要在模块级别获取 logger"></a>除非 disable_existing_loggers == False，否则不要在模块级别获取 logger</h2><p>你可以看到很多的例子（包括这篇文章）在模块级别获取 logger。这看上去是无害的，<br>但是实际上，这是一个陷阱 - 在你从一个文件加载配置前，logging 模块会遵守所有<br>已经创建的 logger，如果你在模块级别获取 logger，像这种：</p>
<hr>
<p>my_module.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    logger.info(<span class="string">'Hi, foo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self)</span>:</span></span><br><span class="line">        logger.info(<span class="string">'Hi, bar'</span>)</span><br></pre></td></tr></table></figure></p>
<hr>
<p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># load my module</span></span><br><span class="line"><span class="keyword">import</span> my_module</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the logging configuration</span></span><br><span class="line">logging.config.fileConfig(<span class="string">'logging.ini'</span>)</span><br><span class="line"></span><br><span class="line">my_module.foo()</span><br><span class="line">bar = my_module.Bar()</span><br><span class="line">bar.bar()</span><br></pre></td></tr></table></figure>
<hr>
<p>logging.ini</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[loggers]</span><br><span class="line">keys=root</span><br><span class="line"></span><br><span class="line">[handlers]</span><br><span class="line">keys=consoleHandler</span><br><span class="line"></span><br><span class="line">[formatters]</span><br><span class="line">keys=simpleFormatter</span><br><span class="line"></span><br><span class="line">[logger_root]</span><br><span class="line">level=DEBUG</span><br><span class="line">handlers=consoleHandler</span><br><span class="line"></span><br><span class="line">[handler_consoleHandler]</span><br><span class="line">class=StreamHandler</span><br><span class="line">level=DEBUG</span><br><span class="line">formatter=simpleFormatter</span><br><span class="line">args=(sys.stdout,)</span><br><span class="line"></span><br><span class="line">[formatter_simpleFormatter]</span><br><span class="line">format=%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><br><span class="line">datefmt=</span><br></pre></td></tr></table></figure>
<hr>
<p>你期望看到记录显示在日志中，但是日志中是空的。为什么？ 因为你在模块级别创建 logger ，<br>所以在从文件加载 logging 配置之前导入该模块。 logging.fileConfig 和 logging.dictConfig<br>默认禁用已经存在的 logger。 所以配置文件中的配置不会在你的 logger 中生效。<br>这适合在你需要的时候获取 logger。 你可以像下面这样编写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    logger = logging.getLogger(__name__)</span><br><span class="line">    logger.info(<span class="string">'Hi, foo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logger=None)</span>:</span></span><br><span class="line">        self.logger = logger <span class="keyword">or</span> logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.logger.info(<span class="string">'Hi, bar'</span>)</span><br></pre></td></tr></table></figure>
<p>通过这样做， logger 将会在你加载配置之后创建，配置会正确生效。</p>
<p>从 Python 2.7 开始，添加一个新的参数名为 “disable_existing_loggers” 到 fileConfig 和<br>dictConfig，通过将其设置为 False，可以解决上面提到的问题。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load config from file</span></span><br><span class="line"><span class="comment"># logging.config.fileConfig('logging.ini', disable_existing_loggers=False)</span></span><br><span class="line"><span class="comment"># or, for dictConfig</span></span><br><span class="line">logging.config.dictConfig(&#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="keyword">False</span>,  <span class="comment"># this fixes the problem</span></span><br><span class="line">    <span class="string">'formatters'</span>: &#123;</span><br><span class="line">        <span class="string">'standard'</span>: &#123;</span><br><span class="line">            <span class="string">'format'</span>: <span class="string">'%(asctime)s [%(levelname)s] %(name)s: %(message)s'</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'level'</span>:<span class="string">'INFO'</span>,</span><br><span class="line">            <span class="string">'class'</span>:<span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">        <span class="string">''</span>: &#123;</span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'default'</span>],</span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">            <span class="string">'propagate'</span>: <span class="keyword">True</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">'It works!'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="使用-JSON-和-YAML-配置-logging"><a href="#使用-JSON-和-YAML-配置-logging" class="headerlink" title="使用 JSON 和 YAML 配置 logging"></a>使用 JSON 和 YAML 配置 logging</h2><p>你可以再 Python 代码中配置 logging 参数，但是这不够灵活。更好的方式<br>是使用 logging 配置文件。在 Python2.7 之后，你可以加载 logging 配置<br>从一个字典，这意味着你可以从 JSON 或 YAML 文件中加载 logging 配置。<br>虽然你可以通过 old.ini 方式加载 logging 配置，但是这对于可读性和可编辑<br>来说是困难的。这里我将展示通过 JSON 或者 YAML 的配置文件示例。</p>
<hr>
<p>logging.json </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"disable_existing_loggers"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"formatters"</span>: &#123;</span><br><span class="line">        <span class="attr">"simple"</span>: &#123;</span><br><span class="line">            <span class="attr">"format"</span>: <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"handlers"</span>: &#123;</span><br><span class="line">        <span class="attr">"console"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.StreamHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"DEBUG"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"stream"</span>: <span class="string">"ext://sys.stdout"</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">"info_file_handler"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.handlers.RotatingFileHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"INFO"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"filename"</span>: <span class="string">"info.log"</span>,</span><br><span class="line">            <span class="attr">"maxBytes"</span>: <span class="number">10485760</span>,</span><br><span class="line">            <span class="attr">"backupCount"</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">"encoding"</span>: <span class="string">"utf8"</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">"error_file_handler"</span>: &#123;</span><br><span class="line">            <span class="attr">"class"</span>: <span class="string">"logging.handlers.RotatingFileHandler"</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"ERROR"</span>,</span><br><span class="line">            <span class="attr">"formatter"</span>: <span class="string">"simple"</span>,</span><br><span class="line">            <span class="attr">"filename"</span>: <span class="string">"errors.log"</span>,</span><br><span class="line">            <span class="attr">"maxBytes"</span>: <span class="number">10485760</span>,</span><br><span class="line">            <span class="attr">"backupCount"</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">"encoding"</span>: <span class="string">"utf8"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"loggers"</span>: &#123;</span><br><span class="line">        <span class="attr">"my_module"</span>: &#123;</span><br><span class="line">            <span class="attr">"level"</span>: <span class="string">"ERROR"</span>,</span><br><span class="line">            <span class="attr">"handlers"</span>: [<span class="string">"console"</span>],</span><br><span class="line">            <span class="attr">"propagate"</span>: <span class="string">"no"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"root"</span>: &#123;</span><br><span class="line">        <span class="attr">"level"</span>: <span class="string">"INFO"</span>,</span><br><span class="line">        <span class="attr">"handlers"</span>: [<span class="string">"console"</span>, <span class="string">"info_file_handler"</span>, <span class="string">"error_file_handler"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>logging.yaml </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">disable_existing_loggers:</span> <span class="literal">False</span></span><br><span class="line"><span class="attr">formatters:</span></span><br><span class="line"><span class="attr">    simple:</span></span><br><span class="line"><span class="attr">        format:</span> <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">handlers:</span></span><br><span class="line"><span class="attr">    console:</span></span><br><span class="line"><span class="attr">        class:</span> <span class="string">logging.StreamHandler</span></span><br><span class="line"><span class="attr">        level:</span> <span class="string">DEBUG</span></span><br><span class="line"><span class="attr">        formatter:</span> <span class="string">simple</span></span><br><span class="line"><span class="attr">        stream:</span> <span class="attr">ext://sys.stdout</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    info_file_handler:</span></span><br><span class="line"><span class="attr">        class:</span> <span class="string">logging.handlers.RotatingFileHandler</span></span><br><span class="line"><span class="attr">        level:</span> <span class="string">INFO</span></span><br><span class="line"><span class="attr">        formatter:</span> <span class="string">simple</span></span><br><span class="line"><span class="attr">        filename:</span> <span class="string">info.log</span></span><br><span class="line"><span class="attr">        maxBytes:</span> <span class="number">10485760</span> <span class="comment"># 10MB</span></span><br><span class="line"><span class="attr">        backupCount:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">        encoding:</span> <span class="string">utf8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    error_file_handler:</span></span><br><span class="line"><span class="attr">        class:</span> <span class="string">logging.handlers.RotatingFileHandler</span></span><br><span class="line"><span class="attr">        level:</span> <span class="string">ERROR</span></span><br><span class="line"><span class="attr">        formatter:</span> <span class="string">simple</span></span><br><span class="line"><span class="attr">        filename:</span> <span class="string">errors.log</span></span><br><span class="line"><span class="attr">        maxBytes:</span> <span class="number">10485760</span> <span class="comment"># 10MB</span></span><br><span class="line"><span class="attr">        backupCount:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">        encoding:</span> <span class="string">utf8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">loggers:</span></span><br><span class="line"><span class="attr">    my_module:</span></span><br><span class="line"><span class="attr">        level:</span> <span class="string">ERROR</span></span><br><span class="line"><span class="attr">        handlers:</span> <span class="string">[console]</span></span><br><span class="line"><span class="attr">        propagate:</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="attr">root:</span></span><br><span class="line"><span class="attr">    level:</span> <span class="string">INFO</span></span><br><span class="line"><span class="attr">    handlers:</span> <span class="string">[console,</span> <span class="string">info_file_handler,</span> <span class="string">error_file_handler]</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>以下配置展示了如何从 json 文件中读取 logging 配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup_logging</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    default_path=<span class="string">'logging.json'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    default_level=logging.INFO,</span></span></span><br><span class="line"><span class="function"><span class="params">    env_key=<span class="string">'LOG_CFG'</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span>:</span></span><br><span class="line">    <span class="string">"""Setup logging configuration</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    path = default_path</span><br><span class="line">    value = os.getenv(env_key, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> value:</span><br><span class="line">        path = value</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'rt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            config = json.load(f)</span><br><span class="line">        logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=default_level)</span><br></pre></td></tr></table></figure>
<p>使用 JSON 配置的一个优点是 json 是标准库中的模块，你不需要安装。但就个人来说，<br>我更喜欢 YAML。这有非常好的可读性和可编辑性。你可以按照以下方式加载 YAML 配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">import</span> <span class="string">os</span></span><br><span class="line"><span class="string">import</span> <span class="string">logging.config</span></span><br><span class="line"></span><br><span class="line"><span class="string">import</span> <span class="string">yaml</span></span><br><span class="line"></span><br><span class="line"><span class="string">def</span> <span class="string">setup_logging(</span></span><br><span class="line">    <span class="string">default_path='logging.yaml',</span></span><br><span class="line">    <span class="string">default_level=logging.INFO,</span></span><br><span class="line">    <span class="string">env_key='LOG_CFG'</span></span><br><span class="line"><span class="string">):</span></span><br><span class="line">    <span class="string">""</span><span class="string">"Setup logging configuration</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="string">path</span> <span class="string">=</span> <span class="string">default_path</span></span><br><span class="line">    <span class="string">value</span> <span class="string">=</span> <span class="string">os.getenv(env_key,</span> <span class="string">None)</span></span><br><span class="line">    <span class="string">if</span> <span class="attr">value:</span></span><br><span class="line">        <span class="string">path</span> <span class="string">=</span> <span class="string">value</span></span><br><span class="line">    <span class="string">if</span> <span class="string">os.path.exists(path):</span></span><br><span class="line">        <span class="string">with</span> <span class="string">open(path,</span> <span class="string">'rt'</span><span class="string">)</span> <span class="string">as</span> <span class="attr">f:</span></span><br><span class="line">            <span class="string">config</span> <span class="string">=</span> <span class="string">yaml.safe_load(f.read())</span></span><br><span class="line">        <span class="string">logging.config.dictConfig(config)</span></span><br><span class="line"><span class="attr">    else:</span></span><br><span class="line">        <span class="string">logging.basicConfig(level=default_level)</span></span><br></pre></td></tr></table></figure>
<p>现在，要配置 logging，你可以在程序启动时调用 setup_logging。这将读取 logging.json 或者<br>logging.yaml。你也可以设置 LOG_CFG 环境变量去从指定的路径下加载配置文件。比如：</p>
<p><code>LOG_CFG=my_logging.json python my_server.py</code></p>
<p>或者</p>
<p><code>LOG_CFG=my_logging.yaml python my_server.py</code></p>
<h2 id="配置文件轮询"><a href="#配置文件轮询" class="headerlink" title="配置文件轮询"></a>配置文件轮询</h2><p>如果你使用 FileHandler 去写日志，随着时间的增加日志文件大小也会增长，某一天，会撑爆你的磁盘。<br>为了避免这种情况，你应该在生产环境中使用 RotatingFileHandler 替换 FileHandler 。</p>
<h2 id="配置日志中心"><a href="#配置日志中心" class="headerlink" title="配置日志中心"></a>配置日志中心</h2><p>当你有多台服务器和不同的日志文件时，你可以配置一个日志中心去手机所有重要的文件。这样你可以<br>更方便的监控和通知你的系统发生了哪些报错。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>我很开心 Python logging 库设置的很好，最好的是它是标准库中的一员，你无须选择。<br>它非常灵活，你可以编辑自己的处理器和过滤器。还有第三方程序比如 pyzmq 提供的 ZeroMQ 日志处理，<br>它允许你通过 zmq socket 发送日志信息。<br>如果你不知道如何正确的使用 logging，那么本文对你会有所帮助。通过良好的日志记录练习，<br>你可以更轻松的找到系统中的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zdyxry.com/2018/07/22/译-python-logging-最佳实践/" data-id="cjtbcgsfq002k3z79nn7vq1y5" class="article-share-link">Share</a>
      
        <a href="http://zdyxry.com/2018/07/22/译-python-logging-最佳实践/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logging/">logging</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/07/28/RPM-常用构建方式/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          RPM 常用构建方式
        
      </div>
    </a>
  
  
    <a href="/2018/07/08/Flask-流式响应/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Flask 流式响应</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bash/">Bash</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Book/">Book</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hardware/">Hardware</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/">Json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Libvirt/">Libvirt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LiveCD/">LiveCD</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenvSwitch/">OpenvSwitch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ops/">Ops</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/">Server</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socket/">Socket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/alogrithms/">alogrithms</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cgroups/">cgroups</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logging/">logging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qemu/">qemu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zeroconf/">zeroconf</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Ansible/" style="font-size: 12.5px;">Ansible</a> <a href="/tags/Bash/" style="font-size: 12.5px;">Bash</a> <a href="/tags/Book/" style="font-size: 15px;">Book</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/Hardware/" style="font-size: 10px;">Hardware</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Libvirt/" style="font-size: 10px;">Libvirt</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/LiveCD/" style="font-size: 10px;">LiveCD</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a> <a href="/tags/OpenvSwitch/" style="font-size: 10px;">OpenvSwitch</a> <a href="/tags/Ops/" style="font-size: 10px;">Ops</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/Server/" style="font-size: 15px;">Server</a> <a href="/tags/Shell/" style="font-size: 12.5px;">Shell</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/alogrithms/" style="font-size: 17.5px;">alogrithms</a> <a href="/tags/cgroups/" style="font-size: 10px;">cgroups</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/logging/" style="font-size: 10px;">logging</a> <a href="/tags/qemu/" style="font-size: 10px;">qemu</a> <a href="/tags/tools/" style="font-size: 12.5px;">tools</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/zeroconf/" style="font-size: 10px;">zeroconf</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/16/关于-On-Call/">关于 On-Call</a>
          </li>
        
          <li>
            <a href="/2019/03/10/Python-调用-systemd-watchdog-方法/">Python 调用 systemd watchdog 方法</a>
          </li>
        
          <li>
            <a href="/2019/03/09/Python-生成器使用/">Python 生成器使用</a>
          </li>
        
          <li>
            <a href="/2019/03/02/Libvirt-CPU-配置/">Libvirt CPU 配置</a>
          </li>
        
          <li>
            <a href="/2019/02/05/学会拒绝/">学会拒绝</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 yiran<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'zdyxry';
  
  var disqus_url = 'http://zdyxry.com/2018/07/22/译-python-logging-最佳实践/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>