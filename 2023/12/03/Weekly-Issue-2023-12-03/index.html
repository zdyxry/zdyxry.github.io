<!doctype html><html lang=zh-cn><head><title>Weekly Issue 2023-12-03 · Yiran's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Yiran Zhou"><meta name=description content="文章 链接到标题 技术 链接到标题 S3 Express is All You Need - WarpStream
[[AWS]] [[S3 Express]] 发布，每 GB 的存储成本比 S3 标准高 8 倍。超过 512KB 的每个 API 操作（写入/读取）按 GB 收费。对于大容量场景，S3 Express 不会带来显著的成本或性能改进，但是从软件设计上，可以完全围绕对象存储来构建，比在应用程序层手动复制数据更便宜、更耐用并且更不容易出错。
[[baotiao]] 前两天发布的推特也是类似的观点：
我觉得学术界和工业界还是有点脱钩, 还在研究一些在 数据库在 modern hardware 上的优化, 我理解以后的数据库大部分应该是针对云上的硬件进行优化了, 包括 VM, essd 等等
Rust std fs 比 Python 慢！真的吗！？
从最初的用户上报，到一点点的复现问题，进行各种尝试，包括不限于：更换内存分配器、调整 mitigations、调整透明大页、调整 NUMA等等。最终确定是与 FSRM 相关。社区力量大啊。
如何发现 offset 的差异：
两个相同的系统调用不可能有不同的时间，在排除了 length 参数差异之后，找到了 -e raw=read 参数，发现了 offset 差异。
FSRM，即 Fast Short REP MOV，是英特尔最初的创新，近期也被AMD采纳，用以提升 rep movsb 和 rep movsd 的速度。它旨在提高大量内存复制的效率。声明支持它的CPU将在 glibc 中默认使用 FSRM。"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Weekly Issue 2023-12-03"><meta name=twitter:description content="文章 链接到标题 技术 链接到标题 S3 Express is All You Need - WarpStream
[[AWS]] [[S3 Express]] 发布，每 GB 的存储成本比 S3 标准高 8 倍。超过 512KB 的每个 API 操作（写入/读取）按 GB 收费。对于大容量场景，S3 Express 不会带来显著的成本或性能改进，但是从软件设计上，可以完全围绕对象存储来构建，比在应用程序层手动复制数据更便宜、更耐用并且更不容易出错。
[[baotiao]] 前两天发布的推特也是类似的观点：
我觉得学术界和工业界还是有点脱钩, 还在研究一些在 数据库在 modern hardware 上的优化, 我理解以后的数据库大部分应该是针对云上的硬件进行优化了, 包括 VM, essd 等等
Rust std fs 比 Python 慢！真的吗！？
从最初的用户上报，到一点点的复现问题，进行各种尝试，包括不限于：更换内存分配器、调整 mitigations、调整透明大页、调整 NUMA等等。最终确定是与 FSRM 相关。社区力量大啊。
如何发现 offset 的差异：
两个相同的系统调用不可能有不同的时间，在排除了 length 参数差异之后，找到了 -e raw=read 参数，发现了 offset 差异。
FSRM，即 Fast Short REP MOV，是英特尔最初的创新，近期也被AMD采纳，用以提升 rep movsb 和 rep movsd 的速度。它旨在提高大量内存复制的效率。声明支持它的CPU将在 glibc 中默认使用 FSRM。"><meta property="og:title" content="Weekly Issue 2023-12-03"><meta property="og:description" content="文章 链接到标题 技术 链接到标题 S3 Express is All You Need - WarpStream
[[AWS]] [[S3 Express]] 发布，每 GB 的存储成本比 S3 标准高 8 倍。超过 512KB 的每个 API 操作（写入/读取）按 GB 收费。对于大容量场景，S3 Express 不会带来显著的成本或性能改进，但是从软件设计上，可以完全围绕对象存储来构建，比在应用程序层手动复制数据更便宜、更耐用并且更不容易出错。
[[baotiao]] 前两天发布的推特也是类似的观点：
我觉得学术界和工业界还是有点脱钩, 还在研究一些在 数据库在 modern hardware 上的优化, 我理解以后的数据库大部分应该是针对云上的硬件进行优化了, 包括 VM, essd 等等
Rust std fs 比 Python 慢！真的吗！？
从最初的用户上报，到一点点的复现问题，进行各种尝试，包括不限于：更换内存分配器、调整 mitigations、调整透明大页、调整 NUMA等等。最终确定是与 FSRM 相关。社区力量大啊。
如何发现 offset 的差异：
两个相同的系统调用不可能有不同的时间，在排除了 length 参数差异之后，找到了 -e raw=read 参数，发现了 offset 差异。
FSRM，即 Fast Short REP MOV，是英特尔最初的创新，近期也被AMD采纳，用以提升 rep movsb 和 rep movsd 的速度。它旨在提高大量内存复制的效率。声明支持它的CPU将在 glibc 中默认使用 FSRM。"><meta property="og:type" content="article"><meta property="og:url" content="https://zdyxry.github.io/2023/12/03/Weekly-Issue-2023-12-03/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-03T00:00:00+00:00"><link rel=canonical href=https://zdyxry.github.io/2023/12/03/Weekly-Issue-2023-12-03/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.76ce9bad7ac9bd368d486c6e91e7e0906fff71d9d35ccbf93959a375e2bf50e5.css integrity="sha256-ds6brXrJvTaNSGxukefgkG//cdnTXMv5OVmjdeK/UOU=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/yiran.png sizes=32x32><link rel=icon type=image/png href=/images/yiran.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.101.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Yiran's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/friends/>Friends</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://zdyxry.github.io/2023/12/03/Weekly-Issue-2023-12-03/>Weekly Issue 2023-12-03</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-12-03T00:00:00Z>December 3, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：2 分钟</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/Weekly/>Weekly</a></span></div></div></header><nav id=TableOfContents><ul><li><a href=#文章>文章</a><ul><li><a href=#技术>技术</a></li><li><a href=#生活>生活</a></li></ul></li><li><a href=#书影>书影</a></li></ul></nav><div class=post-content><h2 id=文章>文章
<a class=heading-link href=#%e6%96%87%e7%ab%a0><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><h3 id=技术>技术
<a class=heading-link href=#%e6%8a%80%e6%9c%af><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p><a href=https://www.warpstream.com/blog/s3-express-is-all-you-need>S3 Express is All You Need - WarpStream</a></p><p>[[AWS]] [[S3 Express]] 发布，每 GB 的存储成本比 S3 标准高 8 倍。超过 512KB 的每个 API 操作（写入/读取）按 GB 收费。对于大容量场景，S3 Express 不会带来显著的成本或性能改进，但是从软件设计上，可以完全围绕对象存储来构建，比在应用程序层手动复制数据更便宜、更耐用并且更不容易出错。</p><p>[[baotiao]] 前两天发布的<a href=https://twitter.com/baotiao/status/1727058804905509126>推特</a>也是类似的观点：</p><blockquote><p>我觉得学术界和工业界还是有点脱钩, 还在研究一些在 数据库在 modern hardware 上的优化, 我理解以后的数据库大部分应该是针对云上的硬件进行优化了, 包括 VM, essd 等等</p></blockquote><hr><p><a href=https://mp.weixin.qq.com/s/m-IBomxu88DlNcEyOgyOew>Rust std fs 比 Python 慢！真的吗！？</a></p><p>从最初的用户上报，到一点点的复现问题，进行各种尝试，包括不限于：更换内存分配器、调整 mitigations、调整透明大页、调整 NUMA等等。最终确定是与 FSRM 相关。社区力量大啊。</p><p>如何发现 offset 的<a href=https://github.com/Xuanwo/blog/discussions/416#discussioncomment-7704455>差异</a>：</p><blockquote><p>两个相同的系统调用不可能有不同的时间，在排除了 <code>length</code> 参数差异之后，找到了 <code>-e raw=read</code> 参数，发现了 offset 差异。</p></blockquote><blockquote><p><code>FSRM</code>，即 <code>Fast Short REP MOV</code>，是英特尔最初的创新，近期也被AMD采纳，用以提升 <code>rep movsb</code> 和 <code>rep movsd</code> 的速度。它旨在提高大量内存复制的效率。声明支持它的CPU将在 <code>glibc</code> 中默认使用 <code>FSRM</code>。</p></blockquote><hr><p><a href=https://twitter.com/halfbloodrock/status/1729876674786070751>X 上的 halfbloodrock：“趁着滴滴宕机10小时，都说是Kubernetes升级引起的，刚好kubernetes是老本行，在eBay那几年，都是在做大规模kubernetes集群管理，kubernetes集群升级这块，正好蹭个热点，讲讲这几年在kubernetes上踩过的坑。” / X</a></p><p>[[kubernetes]] 升级遇到的坑汇总：</p><ul><li>ip pool block要是配小了，很可能出现pod拿不到IP起不来而计算资源空闲的情况。调度器可不看IPAM里还有多少剩余IP</li><li>为啥要改k8s代码？For KPI？ k8s一直到1.12才趋于稳定，比如admission webhook是1.9才引入，到1.13稳定 之前admission上的一些需求只能改上游代码，改动提给社区，人家不一定要，而后面版本cherrypick这些自己改的代码，维护起来还是比较痛苦的。 不过到今天绝大部分需求都不用再改上游代码</li><li>改了上游代码，最好的结果是，提给社区合并进主干。但是大部分情况是提上去的社区不接受，原因众多。 那在下个大版本升级时候，需要把改过的代码cherry-pick进去，解决冲突，过UT，过e2e，过benchmark</li><li>k8s可以应用无感知升级吗？ 至少1.18之前不行 Kubelet升级之后要重新算下pod hash，会重建底层容器，不少应用其实不太能容忍这个动作，每次升级都要收到很多pod重启的抱怨</li><li>有状态应用到底能不能上k8s? k8s的statefulset解决的是pod启动顺序问题，其实真正的核心点是有状态应用如何存数据。 像es这种天生分布式的，可采用本地lvm卷做存储<a href=https://t.co/5uQoqbr3Za>https://github.com/openebs/lvm-localpv…</a> 像MySQL，官方推荐的是mysql cluster+proxy （但是我没在生产上跑过） <a href=https://t.co/V2JUw3lJOt>https://github.com/mysql/mysql-operator</a></li><li>为啥一升级就挂？k8s里有两个地方变动相对频繁，一个是feature gate，一个是api-version 问题七中的坑，1.10之前可以disable这个feature gate，但是1.10之后强制打开，没有disable的机会。 升级过程中发现了，用户改代码没那么快咋办？只能把上游的这个commit 去掉</li><li>能跨版本升级吗？能跨多少版本？ 不要跨超过三个版本：<a href=https://t.co/COop5Y9DxV>https://kubernetes.io/zh-cn/releases/version-skew-policy/…</a> 熟读ChangeLog 曾经的坑，用户在pod里对secret做修改，1.10之后社区去除了这个功能，这直挺挺升级上去用户应用就挂了。这些变动在每个版本ChangeLog里都有</li></ul><hr><p><a href=https://blog.cloudflare.com/cloudflare-gen-12-server-bigger-better-cooler-in-a-2u1n-form-factor/>Cloudflare Gen 12 Server: Bigger, Better, Cooler in a 2U1N form factor</a></p><p>[[CloudFlare]] 12 代服务器硬件设计。CPU TDP 现在的趋势是逐代快速增加，Intel/AMD 下一代 x86 CPU TDP 将达到 500W。</p><p>1U1N 服务器，使用风扇进行散热，每个风扇的功耗是 40W，每台服务器 7-8 个风扇，每台服务器的总系统功耗可能会超过 750W。1U 服务器最多容纳 8 个 40mm 风扇，假设视为是 40 度，8 个风扇最多可以支持 TDP 为 400W 的 CPU，无法支持下一代 CPU。此外，机架有自己的功率限制，考虑到单台服务器的功耗 750W，加上网络设备空间，最终机架空间利用率可能是 50%。</p><p>在计算 TCO 时，虽然单台服务器会随着 CPU TDP 提升而提升，但是因为机架本身又功率和高度限制，最终选择将 1U1N 替换为 2U1N。</p><hr><p><a href=https://engineering.gusto.com/the-weirdest-bug-ive-seen-yet/>The Weirdest Bug I’ve Seen Yet</a></p><p>页面崩溃了，可能是什么原因呢？只影响了Chome？ Chome 版本错误？Chrome 扩展？结果定位到是一个 Gif 导致的。</p><p>这篇博客的调查过程，非常符合我的各个猜测，看到每个猜测被印证是错误的，然后就想继续往下看，写的真好。</p><hr><p><a href=https://olano.dev/2023-11-30-code-is-run-more-than-read/>Code is run more than read</a></p><p>从几个维度思考软件开发，user, maintainer, author 和 business 。</p><ul><li>无法维护的代码： author > maintainer</li><li>无法使用的软件：dev > user</li><li>无法部署的软件：dev > ops</li><li>软件的目的是代码本身：dev > business</li><li>简历驱动开发：dev > *</li><li>想象中的软件：business > user > <del>ops</del> > dev 或者 business > <del>user</del> >ops > dev</li><li>晚期资本主义：<del>business</del> >user > ops > dev</li></ul><p>结论：用户可能不总是优先于业务，但是业务不应该无条件的放在第一位。</p><hr><p><a href=https://moelove.info/2023/11/26/Gateway-API-%E5%B0%86%E6%98%AF-Kubernetes-%E4%B8%AD%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%AA%E6%9D%A5%E5%90%97/>Gateway API 将是 Kubernetes 中流量管理的未来吗？ | MoeLove</a></p><p>[[kubernetes]] [[Gateway API]] 介绍。南北向流量使用 [[Ingress]] 管理，但是 [[Ingress]] 提供的能力较少，依赖 Controller 提供的 CRD 或者 annotation 才可以实现更多的能力，想要在不同的 Ingress Controller 迁移很困难。东西向流量使用 Service 管理，需要配合各种 Service Mesh 项目。</p><p>Gateway API 面向角色，不同的角色进行不同阶段的配置，表现能力更强，扩展性更好（提供了 spec.parametersRef 关联其他自定义资源）。</p><hr><p><a href=https://blog.0x233.cn/blog/2023/12/02/system-ostree-failed/>记一次由 Systemd 超时导致 OSTree 挂载失败的故障调查 | CosPotato&rsquo;s Blog</a></p><p>[[ostree]] 未能按照预期挂载 <code>/ostree/deploy/$stateroot/var</code> ，调查思路从 ostree 到 systemd，主要是集中在 systemd generator 部分，根本原因是虚拟机的 IO 太慢 。之前在非 ostree 场景下也遇到过，比较典型的是 systemd-fsck 的时候失败，导致 os 进入 emergency mode，缓解的办法是调整 systemd timeout，systemd 很复杂，涉及到的 timeout 参数很多，需要找到最小影响范围的 timeout，进行更改，更改的时候尽量采用 drop-in config 的方式。</p><hr><p><a href=https://arstechnica.com/google/2023/12/chromes-next-weapon-in-the-war-on-ad-blockers-slower-extension-updates/>Chrome’s next weapon in the War on Ad Blockers: Slower extension updates | Ars Technica</a></p><p>最近[[Chrome]] 对广告拦截器的针对性动作实在是有点多，有点丧心病狂的意思。</p><hr><p><a href=https://blog.railway.app/p/gcp-incidents>Not Everything Is Google’s Fault (Just Most Things)</a></p><p>[[Railway]] 最开始使用 [[GCP]]，但是体验很糟糕，这篇文章列举了遇到的问题：网络问题、Registry 配额问题、售后支持。现在在逐渐迁移至自己的物理服务器。</p><hr><h3 id=生活>生活
<a class=heading-link href=#%e7%94%9f%e6%b4%bb><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p><a href=https://naev.org/>Naev - Home</a></p><p>Naev 是一款关于太空探索、贸易和战斗的游戏。玩家在银河系中旅行，通过交易、战斗和执行任务来赚钱。</p><hr><p><a href=https://todoist.com/productivity-methods/time-blocking>The Complete Guide to Time Blocking</a></p><p>同事貌似一直深受痛苦，我推荐了[[time-blocking]] 给他，他反馈说还不错（也不知道能坚持多久）。工作方法论，合理的安排时间。</p><hr><p><a href=https://anotherdayu.com/2023/5490/>趁着 2023 Steam 秋季特惠，推荐几款今年比较喜欢的游戏 - Another Dayu</a></p><p>游戏推荐：潜水员戴夫，吸血鬼幸存者，The Battle of Polytopia，Impostor Factory《影子工厂》，Impostor Factory《影子工厂》。
我只玩过吸血鬼幸存者。</p><hr><p><a href=https://sspai.com/post/84574>入门到精通：从今天开始成为感冒专家 - 少数派</a></p><p>最近北京的“感冒”人数貌似多了不少，也持续了一段时间了。</p><ul><li>解热镇痛：对乙酰氨基酚、布洛芬；</li><li>缓解鼻塞、流涕、打喷嚏：氯苯那敏、苯海拉明；</li><li>缓解鼻塞：伪麻黄碱；</li><li>镇咳：右美沙芬、布桂嗪o。</li></ul><hr><p><a href=https://seths.blog/2023/11/working-with-problems/>Working with problems | Seth&rsquo;s Blog</a></p><p>遇到问题的时候，如何处理问题？</p><p>首先需要明确这是一个problem 还是一个situation，problem 有解决方案，无论是解决方案有多么不喜欢，但是总是有解决方案的，但是situation 只是我们需要忍受的事情。关注 situation 通常是压力的来源。
如果一个 problem 已经存在一段时间了，那么说明这个问题无法立即解决，我们需要调整对这个 problem 的期望，可以将其视为一种 situation。</p><hr><p><a href=https://web.archive.org/web/20231201220126/https://mp.weixin.qq.com/s/q6VnNrWvV2Jh9UuTl96dWQ>揭秘拼多多：市值超越阿里，它是怎么做到的？</a></p><blockquote><p>所谓“刚性执行”，<strong>就是绝对服从、没得商量的意思。</strong><br>要做到拼多多这样的强执行，员工应该很痛苦，为什么还有这么多员工愿意来拼多多呢？朋友告诉我，原因很简单，因为给钱多。<br>大家工作是来挣钱的，想让员工服从和努力，就要拿钱说话。<br><strong>因为拼多多一直在筛选，只有为了挣钱、能接受高压和绝对服从的人才能留下来。</strong><br><strong>在管理者的要求和意志面前，服从成为了唯一的选择。</strong></p></blockquote><hr><h2 id=书影>书影
<a class=heading-link href=#%e4%b9%a6%e5%bd%b1><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><p>《征服世界完全手册》，脑洞大开，如果你是一个超级大反派，如何选择自己的基地：地上？地下？水底？需要考虑哪些方面？</p><p>《东京八平米》，对于作者来说，房间大小对生活的影响没有那么大，更多的是自己与周围的连接。作为漂在外面的人，自己和周围的朋友时常感受到无意义/飘泊感，也许我们应该更多的打开自己，多观察周围的生活，多与人沟通交流。<br>记得之前听到过一句话：“考古是考证人类的历史”，对于我们应该也是一样，我们在一座城市生活过，能真正留下记忆的，应该我们在这座城市与人，与城市连接的痕迹，大概率不是我们在出租屋里的一天（如果有，应该也不是什么美好的回忆）。</p><p>引用一段<a href=https://book.douban.com/review/15478523/>豆瓣书评</a>：</p><blockquote><p>无意中读到这本书的时候，我也刚刚搬到新的房间里，也是8、9平米的小房间。我看到一个中年人在八平米的房间里似乎也过得踏实，这给了我一些信心。其实影响我信心的并不是一个八平米的物理空间以及它实际带来的使用效果，而是“一个三十几岁的人还在跟别人合租”这件事。读书以及刚毕业的阶段住在合租房里，到了有一些积蓄、薪水提升、工作稳定后换成自己独自租住的小公寓，到后来有了伴侣、两人买房、拥有自己的房子，——我同龄人都是这样的路径。所以，如今三十好几、独身、还在住在合租公寓里的我，有时也会叩问自己：是因为我开始工作得太晚吗？是因为我没找到伴侣吗？我是不是个Loser？（Loserin）</p></blockquote></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//zdyxry.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2016 -
2023
Yiran Zhou
·
技术支持 <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G0433XDZ3V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G0433XDZ3V",{anonymize_ip:!1})}</script></body></html>