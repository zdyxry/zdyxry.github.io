<!doctype html><html lang=zh-cn><head><title>Weekly Issue 2023-11-26 · Yiran's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Yiran Zhou"><meta name=description content="“好像什么都不想做”，“那就什么都不做”"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Weekly Issue 2023-11-26"><meta name=twitter:description content="“好像什么都不想做”，“那就什么都不做”"><meta property="og:title" content="Weekly Issue 2023-11-26"><meta property="og:description" content="“好像什么都不想做”，“那就什么都不做”"><meta property="og:type" content="article"><meta property="og:url" content="https://zdyxry.github.io/2023/11/26/Weekly-Issue-2023-11-26/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-26T00:00:00+00:00"><link rel=canonical href=https://zdyxry.github.io/2023/11/26/Weekly-Issue-2023-11-26/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.76ce9bad7ac9bd368d486c6e91e7e0906fff71d9d35ccbf93959a375e2bf50e5.css integrity="sha256-ds6brXrJvTaNSGxukefgkG//cdnTXMv5OVmjdeK/UOU=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/yiran.png sizes=32x32><link rel=icon type=image/png href=/images/yiran.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.101.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Yiran's Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li><li class=navigation-item><a class=navigation-link href=/friends/>Friends</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://zdyxry.github.io/2023/11/26/Weekly-Issue-2023-11-26/>Weekly Issue 2023-11-26</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-11-26T00:00:00Z>November 26, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
阅读时间：3 分钟</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/Weekly/>Weekly</a></span></div></div></header><nav id=TableOfContents><ul><li><a href=#文章>文章</a><ul><li><a href=#技术>技术</a></li><li><a href=#生活>生活</a></li></ul></li><li><a href=#书影>书影</a></li></ul></nav><div class=post-content><h2 id=文章>文章
<a class=heading-link href=#%e6%96%87%e7%ab%a0><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><h3 id=技术>技术
<a class=heading-link href=#%e6%8a%80%e6%9c%af><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p><a href=https://twitter.com/Manjusaka_Lee/status/1725931182070837581>X 上的 NadeshikoManju@摇曳露营 S3 2023年四月放送：“阿里的同学关注到了这条推，那我就详细聊聊我用下来的坑点把 1. 先说定位，为什么没有一个 all in one 的 aliyun cli，为什么需要用户一个产品安装一个 CLI？ 2. 然后我们来看安装，为啥不能提供包管理的安装方式，非要用户手动下载二进制。而且你们下载二进制不做 SHA 系的校验和 GPG 签名发布么？” / X</a></p><p>[[Manjusaka]] 提到的关于 [[Aliyun]] <code>ossutils</code> 体验很差的吐槽，其中很多是通用的：</p><ul><li>为什么没有统一的命令行工具，反而需要一个产品提供一个 CLI？</li><li>为什么不提供包管理的安装方式，只提供二进制，但是二进制不做 SHA 校验和 GPG 签名；</li><li>提供的统一配置文件，需要手动填写 endpoint,accessKeySecret, stsToken&mldr;.. 为什么不提供 SSO？<ul><li>不支持单文件内的多个不同账户配置</li></ul></li><li>不支持环境变量指定配置文件；</li><li>CP 命令参数不清晰，&ndash;acl 和 &ndash;meta x-oss-object-acl 的区别？暴露了过多细节给 client；</li><li>不支持 bash_complete ；</li></ul><p>其中 [[ayanamist]] 的总结是：都是外包做的，而且文档都很差，主要是没有办法给些文档这件事打绩效，做 DX 都是无法打绩效的，如何评判工作做的是否好呢？</p><hr><p><a href=https://www.theregister.com/2023/11/16/canonical_microcloud/>Canonical Microcloud: Simple, free, on-prem Linux clustering • The Register</a></p><p>[[Canonical]] 推出 [[Microcloud]] ，应对小型私有云场景，看上去也挺好的，可以用用。（demo 翻车是常见操作了，还是录制视频比较靠谱。</p><hr><p><a href=https://www.inngest.com/blog/python-errors-as-values>Python errors as values: Comparing useful patterns from Go and Rust - Inngest Blog</a></p><p>关于[[python]] 的错误处理，其中提到了 <a href=https://github.com/rustedpy/result>GitHub - rustedpy/result: A simple Rust like Result type for Python 3. Fully type annotated.</a> 这个库，可以让[[python]] 的返回值变为[[Rust]] 模样。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=font-weight:700>result</span> <span style=font-weight:700>import</span> Result, Ok, Err
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> divide(a: int, b: int) -&gt; Result[int, str]:
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> b == 0:
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span> Err(<span style=font-style:italic>&#34;Cannot divide by zero&#34;</span>)
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> Ok(a // b)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>values = [(10, 0), (10, 5)]
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> a, b <span style=font-weight:700>in</span> values:
</span></span><span style=display:flex><span>    divide_result = divide(a, b)
</span></span><span style=display:flex><span>    match divide_result:
</span></span><span style=display:flex><span>        case Ok(value):
</span></span><span style=display:flex><span>            print(<span style=font-style:italic>f</span><span style=font-style:italic>&#34;</span><span style=font-weight:700;font-style:italic>{</span>a<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> // </span><span style=font-weight:700;font-style:italic>{</span>b<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic> == </span><span style=font-weight:700;font-style:italic>{</span>value<span style=font-weight:700;font-style:italic>}</span><span style=font-style:italic>&#34;</span>)
</span></span><span style=display:flex><span>        case Err(e):
</span></span><span style=display:flex><span>            print(e)
</span></span></code></pre></div><hr><p><a href=https://matklad.github.io/2023/11/15/push-ifs-up-and-fors-down.html>Push Ifs Up And Fors Down</a></p><p>将 if 尽可能的放在上面，for 尽可能的放在下面。将条件判断放在函数调用处统一处理，保证函数在执行时的参数始终是正确的。将数据处理统一实现为 batch ，将 batch 操作视为基本情况，将单个处理视为 batch 处理的特殊情况。
实际编写业务代码时，可能大部分场景下都是都是依赖于 walrus 自身属性来进行判断比较多？</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=font-style:italic>// GOOD
</span></span></span><span style=display:flex><span><span style=font-style:italic></span><span style=font-weight:700>if</span> condition {
</span></span><span style=display:flex><span>  <span style=font-weight:700>for</span> walrus <span style=font-weight:700>in</span> walruses {
</span></span><span style=display:flex><span>    walrus.frobnicate()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>} <span style=font-weight:700>else</span> {
</span></span><span style=display:flex><span>  <span style=font-weight:700>for</span> walrus <span style=font-weight:700>in</span> walruses {
</span></span><span style=display:flex><span>    walrus.transmogrify()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=font-style:italic>// BAD
</span></span></span><span style=display:flex><span><span style=font-style:italic></span><span style=font-weight:700>for</span> walrus <span style=font-weight:700>in</span> walruses {
</span></span><span style=display:flex><span>  <span style=font-weight:700>if</span> condition {
</span></span><span style=display:flex><span>    walrus.frobnicate()
</span></span><span style=display:flex><span>  } <span style=font-weight:700>else</span> {
</span></span><span style=display:flex><span>    walrus.transmogrify()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p><a href=https://blog.miguelgrinberg.com/post/it-s-time-for-a-change-datetime-utcnow-is-now-deprecated>It&rsquo;s Time For A Change: datetime.utcnow() Is Now Deprecated - miguelgrinberg.com</a></p><p>[[python]] <code>datetime.datetime</code> 的 <code>utcnow()</code> 和 <code>utcfromtimestamp()</code> 将被移除，需要使用 <code>datetime.datetime.now(datetime.UTC)</code> 来替代。</p><p>根本原因是 <code>utcnow()</code> 和 <code>utcfromtimestamp()</code> 不感知时区，但是有些函数接受时间戳并假设它带边的是带有时区的时间戳。</p><hr><p>[test, [, and [<a href=https://jmmv.dev/2020/03/test-bracket.html> - Julio Merino (jmmv.dev)</a></p><p>很多人第一次编写 [[shell]] 时候，都会遇到 <code>[</code> 和 <code>[[</code> 的问题，这篇文章总结的很好： <code>[</code> 与 <code>test</code> 是一个东西，<code>[[</code> 是 [[Bash]] 中的能力。如果想要写通用的 [[shell]] ，那么使用 <code>[</code> ，如果明确执行的环境是 [[Bash]]，那么保持使用 <code>[[</code> 。</p><hr><p><a href=https://twitter.com/zdyxry/status/1727636324898005405>twitter.com/zdyxry/status/1727636324898005405</a></p><p>我吐槽自己的 <code>onmyzsh</code> 太慢了，大家提供了很多很多的工具和方法，感觉需要汇总整理一波。</p><hr><p><a href=https://www.jimangel.io/posts/vmware-series-p1-considerations/>VMware homelab [Part 1]: Introduction & Considerations | jimangel.io</a></p><p>作者使用 3台 [[NUC]] 来构建自己的 [[homelab]] ，手把手教学。</p><hr><p><a href=https://blog.oneuptime.com/moving-from-aws-to-bare-metal/>How moving from AWS to Bare-Metal saved us $230,000 /yr.</a></p><p>作者从[[AWS]] 迁回自建机房，本身业务 CICD 都是基于 K8s 的，在 BareMetal 上使用 MicroK8s 来管理 K8s 集群，配合使用 [[NFS]] 和 [[MetalLB]] 。</p><hr><p><a href=https://blog.palark.com/vector-to-export-pgsql-logs-into-prometheus/>Exporting PostgreSQL logs into Prometheus metrics using Vector – Palark | Blog</a></p><p>通过 [[vector]] 将 [[PostgreSQL]] 的异常日志暴露给 [[prometheus]]，只需要使用 vector 就可以实现日志的读取、解析、结构化、过滤、转换为 exporter。最终暴露的指标是异常日志的数量，通过检查最近 30min 内日志数量是否有变化来产生报警。
最近有一个需求，需要将 IPMI SEL 通过 exporter 暴露 Metric，在基本的接受到日志就产生告警之外，还需要拿到告警的具体信息，可能需要通过 label 来暴露。</p><hr><p><a href=https://www.windmill.dev/blog/launch-week-1/fastest-workflow-engine>Launch Week Day 3 - Fastest self-hostable open-source workflow engine | Windmill</a></p><p>介绍 [[Windmill]] Workflow ，受伤的只有 [[airflow]] ，[[airflow]] 真的是太慢了。</p><hr><p><a href=https://jordankaye.dev/posts/thinking-not-typing/>Software engineering is about thinking, not typing | Organizing Chaos</a></p><blockquote><p>Weeks of coding can save you hours of planning.</p></blockquote><p>思考的重要性远胜于敲击键盘的重要性。虽然迭代式工作和快速反应变化的能力非常重要，但在着手解决问题之前，仔细思考潜在解决方案的全貌更加有效。</p><hr><p><a href=https://threeofwands.com/the-types-of-errors-in-python-apps/>The Categories of Bugs in Python Apps</a></p><p>将[[Python]] 程序错误分为4类：Type 错误；import 错误；runtime 错误；业务逻辑错误。如何有效的避免这些错误，应该尽可能的降低错误类别，将业务逻辑错误转换为 runtime 错误，将 runtime 错误转换为 import 错误。 尽可能的提前暴露错误。</p><hr><p><a href=https://stefan-marr.de/2023/11/python-global-interpreter-lock/>The Changing “Guarantees” Given by Python&rsquo;s Global Interpreter Lock · Stefan-Marr.de</a></p><p>[[Python GIL]] 的行为在不同版本中的变化，其中提到了Python 3.9和Python 3.13之间GIL实现的差异，特别是在释放GIL的时机上的变化。Python 3.13引入了更强的原子性保证，使得大多数字节码序列都是原子的，而Python 3.9则只有很少一部分字节码序列是原子的。</p><p>在编写代码的时候不应该依赖特定的 GIL 行为。</p><hr><h3 id=生活>生活
<a class=heading-link href=#%e7%94%9f%e6%b4%bb><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h3><p><a href=https://changchen.me/blog/20231117/iphone2android/>为什么我从 iPhone 切换至 Android 手机 | Henry Z&rsquo;s blog~</a></p><p>喜欢这种在购买一件物品前的思考，发现周围有朋友换设备的原因是：”这个手机我已经用 3 年了“，这种非常感性的原因，不从自己的需求出发。</p><hr><p><a href=https://jesor.me/2023/14-times-long-journey/>Faker：再度攀登 | 大破进击</a></p><p>是[[Faker]] 让[[LOL]] 更精彩。</p><hr><p><a href=https://rootly.com/blog/working-effectively-with-executives-during-an-incident>Working Effectively With Executives During an Incident | Rootly</a></p><p>如何让老板知道当前事故的进展？</p><ul><li>明确通知条件（case 级别）</li><li>当前进展<ul><li>对客户造成的影响</li><li>解决问题取得了哪些进展</li><li>相关的文档链接</li></ul></li><li>保持简洁，汇报不要包含过多的技术细节</li><li>重新思考自己的局限性<ul><li>常规处理流程可能会按照既定框架执行，如果没有既定框架，可以做些什么来快速的解决问题？</li></ul></li><li>Why?What?How?</li></ul><hr><p><a href=https://developer.mozilla.org/zh-CN/docs/MDN/Community/Open_source_etiquette>开源项目礼节 - MDN Web 文档项目 | MDN</a></p><p>[[Mozilla]] 开源礼节，友好，耐心。共勉。</p><hr><p><a href=https://www.naradafoundation.org/content/5691>南都观察-旧-在中国，感冒治疗史就是一部药物滥用史-南都公益基金会</a></p><blockquote><p><strong>实际上，在中国治疗感冒，就是一部药物滥用史。</strong>
<strong>大部分感冒真的是喝水喝好的，而不是吃药吃好的。</strong>
<strong>只有病毒引起的，才能称之为感冒。因为致病原因不同，治疗的药物自然是不同的。</strong>
抗生素只对细菌有效，对病毒引起的感冒并无效果。
<strong>感冒需要吃“消炎药”，也是中国人根深蒂固的一种想法。此处的“消炎药”又被窄化为了抗菌素中的抗生素。</strong>
<strong>滥用抗生素只会催生出对抗生素耐药的细菌，甚至是会出现现有抗生素都奈何不了的“超级细菌”。</strong>
<strong>世界卫生组织的调查结果显示：中国住院患者抗生素的使用率高达80%，其中使用广谱抗生素和联合使用两种以上的抗生素的比率高达58%，远超出30%的国际水平。</strong></p></blockquote><p>药，还是别乱吃的好。</p><hr><p><a href=https://milan.cvitkovic.net/writing/things_youre_allowed_to_do/>Things you&rsquo;re allowed to do</a></p><p>可以做的事，有很多事是出于各种原因没有尝试过的。</p><ul><li>可以说“我不知道”；</li><li>不说善意的谎言；</li><li>去见朋友，只是为了见朋友；</li><li>聘请专业的人来帮你完成某些事情；</li><li>接触陌生人；</li></ul><hr><p><a href=https://plug-world.com/posts/stop-obsessing-over-tools/>Stop Obsessing Over Tools | PlugWorld</a></p><blockquote><p>这样做并不会提高你的效率，你永远找不到最好或最完美的设置。我的建议是，只要一样东西足够好、能完成工作，你就不妨坚持用下去。不要盯着工具，而要盯着你要完成的工作。</p></blockquote><p>很多人都在追求工具，在各个社交平台上分享工具总是流量密码，以前我可能也会这样，但是现在除非遇到了问题，否则我会维持现在的工具链。但是同时，我也会关注一些新的工具，了解它们解决什么问题，如何解决的。如果真的适合也会及时尝试，快速试错，来防止自己“过时”。</p><hr><h2 id=书影>书影
<a class=heading-link href=#%e4%b9%a6%e5%bd%b1><i class="fa fa-link" aria-hidden=true title=链接到标题></i>
<span class=sr-only>链接到标题</span></a></h2><p>《涉过愤怒的海》，故事没讲好，想要说家庭，那就讲家庭，试图用几分钟的旁白来解释，太无力了。</p></div><footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//zdyxry.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}(),document.addEventListener("themeChanged",function(){document.readyState=="complete"&&DISQUS.reset({reload:!0,config:disqus_config})})</script></footer></article></section></div><footer class=footer><section class=container>©
2016 -
2023
Yiran Zhou
·
技术支持 <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G0433XDZ3V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G0433XDZ3V",{anonymize_ip:!1})}</script></body></html>