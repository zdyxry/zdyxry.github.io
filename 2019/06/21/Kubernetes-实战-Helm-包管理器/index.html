<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="cR4Tgq6nOHr_Wo0dm8HUK3feA45_XLr5RkA2UC-tXxc">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/yiran.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/yiran.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/yiran.png?v=5.1.4">


  <link rel="mask-icon" href="/images/yiran.png?v=5.1.4" color="#222">





  <meta name="keywords" content="Kubernetes,">





  <link rel="alternate" href="/atom.xml" title="Yiran's Blog" type="application/atom+xml">






<meta name="description" content="简介Helm 就是k8s 的包管理器 。常见的包管理器有：yum,apt,pip… 包管理器基础功能有：  安装 依赖安装   升级 回滚 卸载 源管理 搜索 …  基本概念 Helm: Kubernetes的包管理工具，命令行同名  Tiller: Helmv2 的服务端，用于接收并处理 Helm 发送的请求，默认以 Deployment 形式部署在 k8s 集群中  Chart: Helm 包">
<meta name="keywords" content="Kubernetes">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes 实战-Helm 包管理器">
<meta property="og:url" content="https://zdyxry.github.io/2019/06/21/Kubernetes-实战-Helm-包管理器/index.html">
<meta property="og:site_name" content="Yiran&#39;s Blog">
<meta property="og:description" content="简介Helm 就是k8s 的包管理器 。常见的包管理器有：yum,apt,pip… 包管理器基础功能有：  安装 依赖安装   升级 回滚 卸载 源管理 搜索 …  基本概念 Helm: Kubernetes的包管理工具，命令行同名  Tiller: Helmv2 的服务端，用于接收并处理 Helm 发送的请求，默认以 Deployment 形式部署在 k8s 集群中  Chart: Helm 包">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-06-19T22:54:43.140Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubernetes 实战-Helm 包管理器">
<meta name="twitter:description" content="简介Helm 就是k8s 的包管理器 。常见的包管理器有：yum,apt,pip… 包管理器基础功能有：  安装 依赖安装   升级 回滚 卸载 源管理 搜索 …  基本概念 Helm: Kubernetes的包管理工具，命令行同名  Tiller: Helmv2 的服务端，用于接收并处理 Helm 发送的请求，默认以 Deployment 形式部署在 k8s 集群中  Chart: Helm 包">
<meta name="twitter:creator" content="@zhouyiran1994">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zdyxry.github.io/2019/06/21/Kubernetes-实战-Helm-包管理器/">





  <title>Kubernetes 实战-Helm 包管理器 | Yiran's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-136220198-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yiran's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
            读书
          </a>
        </li>
      
        
        <li class="menu-item menu-item-movies">
          <a href="/movies" rel="section">
            
            观影
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zdyxry.github.io/2019/06/21/Kubernetes-实战-Helm-包管理器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yiran">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/yiran.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiran's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Kubernetes 实战-Helm 包管理器</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-06-21T20:40:24+00:00">
                2019-06-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/21/Kubernetes-实战-Helm-包管理器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/06/21/Kubernetes-实战-Helm-包管理器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Helm 就是<code>k8s 的包管理器</code> 。常见的包管理器有：yum,apt,pip…</p>
<p>包管理器基础功能有：</p>
<ul>
<li>安装<ul>
<li>依赖安装</li>
</ul>
</li>
<li>升级</li>
<li>回滚</li>
<li>卸载</li>
<li>源管理</li>
<li>搜索</li>
<li>…</li>
</ul>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li><p>Helm: Kubernetes的包管理工具，命令行同名</p>
</li>
<li><p>Tiller: Helmv2 的服务端，用于接收并处理 Helm 发送的请求，默认以 Deployment 形式部署在 k8s 集群中</p>
</li>
<li><p>Chart: Helm 包管理的基础单元，等同于 RPM</p>
</li>
<li><p>Repoistory: Helm的软件源仓库，是一个 Web 服务器，路径下除了响应的软件 Chart 包之外，维护了一个 index.yaml 用于索引</p>
</li>
<li><p>Release: Helm 安装在 Kubernetes 集群中的 Chart 实例</p>
</li>
</ul>
<h3 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h3><p>helm 截至06月20日最新稳定版本为 v2.14.1。</p>
<p>在05月16日发布了 v3.0 alpha 版本，根据相关文档描述，v2 无法平滑升级到 v3 版本。</p>
<p>注：存在部分小版本无法平滑升级情况。</p>
<p>helm v3 版本改进：</p>
<ol>
<li>在 v2 版本设计中，需要单独创建属于 Tiller 的 ServiceAccount，授权 clusteradmin 权限，以为着只要你有 helm 权限，那么你有操作 k8s全集群所有权限。在 v3 版本中删除 Tiller，直接与 k8s api 进行通信，权限管理更清晰</li>
<li>helm 提供 libary</li>
<li>模板引擎切换为 Lua</li>
<li>目前通过 Hook 方式创建的资源，helm 后续不会管理，在 v3 会增加管理 Hook 资源功能</li>
<li>目前所有配置保存在 cm 中，后续考虑保存到 secret</li>
<li>v2 需要单独维护仓库，v3 中可以将 Chart 推送到 Docker 镜像仓库中，提供 helm push/login 功能</li>
<li>…</li>
</ol>
<h2 id="Helm2-基本使用"><a href="#Helm2-基本使用" class="headerlink" title="Helm2 基本使用"></a>Helm2 基本使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在 Helm Github <a href="https://github.com/helm/helm/releases" target="_blank" rel="noopener">Release</a> 下载最新版本二进制文件，并在本地解压。</p>
<p>在 k8s master 节点，执行 <code>helm init --server-account tiller</code> 将 Tiller 部署在 k8s 集群中，指定 Service Account 为 Tiller。</p>
<p>在 k8s 1.6 版本之后，需要创建对应的 ServiceAccount 资源给 Tiller ，便于 Tiller 后续创建资源，参考官方文档：</p>
<p>rbac-config.yaml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">tiller</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">tiller</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">  apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">  kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="attr">  - kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">tiller</span></span><br><span class="line"><span class="attr">    namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f rbac-config.yaml</span><br><span class="line">serviceaccount <span class="string">"tiller"</span> created</span><br><span class="line">clusterrolebinding <span class="string">"tiller"</span> created</span><br></pre></td></tr></table></figure>
<p>通过 <code>helm version</code> 验证是否部署成功，成功会显示 client 和 server 对应版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm version</span></span><br><span class="line">Client: &amp;version.Version&#123;SemVer:<span class="string">"v2.14.1"</span>, GitCommit:<span class="string">"5270352a09c7e8b6e8c9593002a73535276507c0"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:<span class="string">"v2.14.1"</span>, GitCommit:<span class="string">"5270352a09c7e8b6e8c9593002a73535276507c0"</span>, GitTreeState:<span class="string">"clean"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><h4 id="Chart构建"><a href="#Chart构建" class="headerlink" title="Chart构建"></a>Chart构建</h4><p>本地创建一个测试软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm create yiran-test</span></span><br><span class="line">Creating yiran-test</span><br><span class="line">[root@node1 helm]<span class="comment"># tree yiran-test/</span></span><br><span class="line">yiran-test/</span><br><span class="line">├── charts                            <span class="comment"># yiran-test 所依赖的 Chart，此处为空</span></span><br><span class="line">├── Chart.yaml                        <span class="comment"># yiran-test 的基本信息，包含：名称，apiversion, appversion, version</span></span><br><span class="line">├── templates</span><br><span class="line">│   ├── deployment.yaml               <span class="comment"># 配置模板路径</span></span><br><span class="line">│   ├── _helpers.tpl                  <span class="comment"># 用于修改kubernetes objcet配置的模板</span></span><br><span class="line">│   ├── ingress.yaml                  <span class="comment"># </span></span><br><span class="line">│   ├── NOTES.txt                     <span class="comment"># 类似于 Chart README</span></span><br><span class="line">│   ├── service.yaml                  <span class="comment"># </span></span><br><span class="line">│   └── tests</span><br><span class="line">│       └── <span class="built_in">test</span>-connection.yaml      <span class="comment"># 测试模板</span></span><br><span class="line">└── values.yaml                       <span class="comment"># 用于渲染模板的具体值</span></span><br><span class="line"></span><br><span class="line">3 directories, 8 files</span><br></pre></td></tr></table></figure>
<p>有了基础示例，我们可以先通过 <code>dry-run</code> 方式跑一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yiran-test]<span class="comment"># helm install --dry-run --debug ./</span></span><br><span class="line">[debug] Created tunnel using <span class="built_in">local</span> port: <span class="string">'39257'</span></span><br><span class="line"></span><br><span class="line">[debug] SERVER: <span class="string">"127.0.0.1:39257"</span></span><br><span class="line"></span><br><span class="line">[debug] Original chart version: <span class="string">""</span></span><br><span class="line">[debug] CHART PATH: /root/helm/yiran-test</span><br><span class="line"></span><br><span class="line">NAME:   torrid-rodent</span><br><span class="line">REVISION: 1</span><br><span class="line">RELEASED: Thu Jun 20 19:10:08 2019</span><br><span class="line">CHART: yiran-test-0.1.0</span><br><span class="line">USER-SUPPLIED VALUES:</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">COMPUTED VALUES:</span><br><span class="line">affinity: &#123;&#125;</span><br><span class="line">fullnameOverride: <span class="string">""</span></span><br><span class="line">image:</span><br><span class="line">  pullPolicy: IfNotPresent</span><br><span class="line">  repository: nginx</span><br><span class="line">  tag: stable</span><br><span class="line">imagePullSecrets: []</span><br><span class="line">ingress:</span><br><span class="line">  annotations: &#123;&#125;</span><br><span class="line">  enabled: <span class="literal">false</span></span><br><span class="line">  hosts:</span><br><span class="line">  - host: chart-example.local</span><br><span class="line">    paths: []</span><br><span class="line">  tls: []</span><br><span class="line">nameOverride: <span class="string">""</span></span><br><span class="line">nodeSelector: &#123;&#125;</span><br><span class="line">replicaCount: 1</span><br><span class="line">resources: &#123;&#125;</span><br><span class="line">service:</span><br><span class="line">  port: 80</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">tolerations: []</span><br><span class="line"></span><br><span class="line">HOOKS:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># torrid-rodent-yiran-test-test-connection</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: <span class="string">"torrid-rodent-yiran-test-test-connection"</span></span><br><span class="line">  labels:</span><br><span class="line">    app.kubernetes.io/name: yiran-test</span><br><span class="line">    helm.sh/chart: yiran-test-0.1.0</span><br><span class="line">    app.kubernetes.io/instance: torrid-rodent</span><br><span class="line">    app.kubernetes.io/version: <span class="string">"1.0"</span></span><br><span class="line">    app.kubernetes.io/managed-by: Tiller</span><br><span class="line">  annotations:</span><br><span class="line">    <span class="string">"helm.sh/hook"</span>: <span class="built_in">test</span>-success</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: wget</span><br><span class="line">      image: busybox</span><br><span class="line">      <span class="built_in">command</span>: [<span class="string">'wget'</span>]</span><br><span class="line">      args:  [<span class="string">'torrid-rodent-yiran-test:80'</span>]</span><br><span class="line">  restartPolicy: Never</span><br><span class="line">MANIFEST:</span><br></pre></td></tr></table></figure>
<h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>可以看到生成的 YAML 文件就是拿 values.yaml 值渲染模板生成的，那么我们来安装一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yiran-test]<span class="comment"># helm install ./</span></span><br><span class="line">NAME:   precise-bear</span><br><span class="line">LAST DEPLOYED: Thu Jun 20 19:12:01 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME                     READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">precise-bear-yiran-test  0/1    0           0          1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                                      READY  STATUS             RESTARTS  AGE</span><br><span class="line">precise-bear-yiran-test-785f967587-9rll6  0/1    ContainerCreating  0         1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                     TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)  AGE</span><br><span class="line">precise-bear-yiran-test  ClusterIP  10.68.142.106  &lt;none&gt;       80/TCP   1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">1. Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">"app.kubernetes.io/name=yiran-test,app.kubernetes.io/instance=precise-bear"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to use your application"</span></span><br><span class="line">  kubectl port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line"></span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm list </span></span><br><span class="line">NAME            REVISION    UPDATED                     STATUS      CHART               APP VERSION NAMESPACE</span><br><span class="line">precise-bear    1           Thu Jun 20 19:12:01 2019    DEPLOYED    yiran-test-0.1.0    1.0         default  </span><br><span class="line">[root@node1 yiran-test]<span class="comment"># kubectl get pod </span></span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">precise-bear-yiran-test-785f967587-9rll6   0/1     Running   0          7s</span><br></pre></td></tr></table></figure>
<p>注意，此时我们已经创建好了对应的资源，可以通过 <code>kubectl</code> 来查看状态。</p>
<h4 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h4><p>我们来修改一下 <code>yiran-test/Chart.yaml</code> ，调整下版本，进行升级：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yiran-test]<span class="comment"># cat Chart.yaml</span></span><br><span class="line">apiVersion: v2</span><br><span class="line">appVersion: <span class="string">"2.0"</span></span><br><span class="line">description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">name: yiran-test</span><br><span class="line">version: 0.2.0</span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm list </span></span><br><span class="line">heNAME          REVISION    UPDATED                     STATUS      CHART               APP VERSION NAMESPACE</span><br><span class="line">precise-bear    1           Thu Jun 20 19:12:01 2019    DEPLOYED    yiran-test-0.1.0    1.0         default  </span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm upgrade precise-bear ./</span></span><br><span class="line">Release <span class="string">"precise-bear"</span> has been upgraded.</span><br><span class="line">LAST DEPLOYED: Thu Jun 20 19:18:30 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME                     READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">precise-bear-yiran-test  1/1    1           1          6m30s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                                      READY  STATUS   RESTARTS  AGE</span><br><span class="line">precise-bear-yiran-test-785f967587-9rll6  1/1    Running  0         6m30s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                     TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)  AGE</span><br><span class="line">precise-bear-yiran-test  ClusterIP  10.68.142.106  &lt;none&gt;       80/TCP   6m30s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">1. Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">"app.kubernetes.io/name=yiran-test,app.kubernetes.io/instance=precise-bear"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to use your application"</span></span><br><span class="line">  kubectl port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line"></span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm list </span></span><br><span class="line">NAME            REVISION    UPDATED                     STATUS      CHART               APP VERSION NAMESPACE</span><br><span class="line">precise-bear    2           Thu Jun 20 19:18:30 2019    DEPLOYED    yiran-test-0.2.0    2.0         default</span><br></pre></td></tr></table></figure>
<h4 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h4><p>通过上述步骤，我们已经把我们的应用 <code>yiran-test</code> 从 <code>0.1.0</code> 版本升级到了 <code>0.2.0</code> 版本，那么我们现在来尝试下回滚。</p>
<p>helm 回滚操作需要指定 Release 名称和目标版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yiran-test]<span class="comment"># helm list </span></span><br><span class="line">NAME            REVISION    UPDATED                     STATUS      CHART               APP VERSION NAMESPACE</span><br><span class="line">precise-bear    2           Thu Jun 20 19:18:30 2019    DEPLOYED    yiran-test-0.2.0    2.0         default  </span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm rollback precise-bear 1</span></span><br><span class="line">Rollback was a success.</span><br><span class="line">[root@node1 yiran-test]<span class="comment"># helm list </span></span><br><span class="line">NAME            REVISION    UPDATED                     STATUS      CHART               APP VERSION NAMESPACE</span><br><span class="line">precise-bear    3           Thu Jun 20 19:23:04 2019    DEPLOYED    yiran-test-0.1.0    1.0         default</span><br></pre></td></tr></table></figure>
<p>嗯，可以看到，我们指定了回滚的目标 REVISION，回滚成功了，<code>yiran-test</code> 回到了 <code>0.1.0</code> 版本，但是，最恶心的来了，Release 的当前版本变成了 <code>3</code> ，而不是设想中的 <code>1</code> 。</p>
<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><p>如果我们想要从 k8s 上卸载对应的软件，也就是我们的 <code>yiran-test</code> ，我们可以直接执行 <code>delete</code> 命令，会直接把相关资源全部删除掉。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># helm list</span></span><br><span class="line">NAME            REVISION        UPDATED                         STATUS          CHART                   APP VERSION     NAMESPACE</span><br><span class="line">precise-bear    3               Thu Jun 20 19:23:04 2019        DEPLOYED        yiran-test-0.1.0        1.0             default</span><br><span class="line">[root@node1 ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">kuNAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">precise-bear-yiran-test-785f967587-9rll6   1/1     Running   0          139m</span><br><span class="line">[root@node1 ~]<span class="comment"># kubectl get svc</span></span><br><span class="line">NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes                ClusterIP   10.68.0.1       &lt;none&gt;        443/TCP   36d</span><br><span class="line">precise-bear-yiran-test   ClusterIP   10.68.142.106   &lt;none&gt;        80/TCP    139m</span><br><span class="line">[root@node1 ~]<span class="comment"># helm delete precise-bear</span></span><br><span class="line">release <span class="string">"precise-bear"</span> deleted</span><br><span class="line">[root@node1 ~]<span class="comment"># helm list</span></span><br><span class="line">[root@node1 ~]<span class="comment"># kubectl get pod</span></span><br><span class="line">NAME                                       READY   STATUS        RESTARTS   AGE</span><br><span class="line">precise-bear-yiran-test-785f967587-9rll6   0/1     Terminating   0          139m</span><br><span class="line">[root@node1 ~]<span class="comment"># kubectl get svc</span></span><br><span class="line">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   ClusterIP   10.68.0.1    &lt;none&gt;        443/TCP   36d</span><br></pre></td></tr></table></figure>
<h4 id="软件源管理"><a href="#软件源管理" class="headerlink" title="软件源管理"></a>软件源管理</h4><p>上面我们所有的操作都是针对本地包（路径），那么我们怎么才能通过网络下载别人已经构建好的软件包呢？ </p>
<p>helm 使用 <code>repo</code> 命令来管理软件源，使用上也很简单，简单列举下相应命令实用说明：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># helm repo list</span></span><br><span class="line">NAME    URL</span><br><span class="line">stable          https://kubernetes-charts.storage.googleapis.com</span><br><span class="line"><span class="built_in">local</span>   http://127.0.0.1:8879/charts</span><br><span class="line">[root@node1 ~]<span class="comment"># helm repo add stable-mirror https://burdenbear.github.io/kube-charts-mirror/</span></span><br><span class="line"><span class="string">"stable-mirror"</span> has been added to your repositories</span><br><span class="line">[root@node1 ~]<span class="comment"># helm repo add stable https://kubernetes-charts.storage.googleapis.com</span></span><br><span class="line">helm repo list</span><br><span class="line"><span class="string">"stable"</span> has been added to your repositories</span><br><span class="line">[root@node1 ~]<span class="comment"># helm repo list</span></span><br><span class="line">NAME            URL</span><br><span class="line">stable          https://kubernetes-charts.storage.googleapis.com</span><br><span class="line"><span class="built_in">local</span>           http://127.0.0.1:8879/charts</span><br><span class="line">stable-mirror   https://burdenbear.github.io/kube-charts-mirror/</span><br><span class="line">[root@node1 ~]<span class="comment"># helm repo remove local</span></span><br><span class="line"><span class="string">"local"</span> has been removed from your repositories</span><br><span class="line">[root@node1 ~]<span class="comment"># helm repo list</span></span><br><span class="line">NAME            URL</span><br><span class="line">stable          https://kubernetes-charts.storage.googleapis.com</span><br><span class="line">stable-mirror   https://burdenbear.github.io/kube-charts-mirror/</span><br></pre></td></tr></table></figure>
<h4 id="软件搜索"><a href="#软件搜索" class="headerlink" title="软件搜索"></a>软件搜索</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># helm search mongo</span></span><br><span class="line">NAME                                            CHART VERSION   APP VERSION     DESCRIPTION</span><br><span class="line">stable-mirror/mongodb                           5.20.0          4.0.10          NoSQL document-oriented database that stores JSON-like <span class="keyword">do</span>...</span><br><span class="line">stable-mirror/mongodb-replicaset                3.9.6           3.6             </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="打包与本地软件源构建"><a href="#打包与本地软件源构建" class="headerlink" title="打包与本地软件源构建"></a>打包与本地软件源构建</h4><p>Helm v2 命令支持本地创建软件源，命令关键字是 <code>helm serve</code> ，下面来演示下相关操作：</p>
<p>启动本地源，并指定 IP 地址和 repo 路径：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># pwd</span></span><br><span class="line">/root/helm</span><br><span class="line">[root@node1 helm]<span class="comment"># ls </span></span><br><span class="line">rbac-config.yaml  yiran-test</span><br><span class="line">[root@node1 helm]<span class="comment"># helm serve --address 192.168.27.231:8879 --repo-path /root/helm/ </span></span><br><span class="line">Regenerating index. This may take a moment.</span><br><span class="line">Now serving you on 192.168.27.231:8879</span><br></pre></td></tr></table></figure></p>
<p>新开终端，通过修改 <code>yiran-test</code> 的 Chart.yaml 文件打包两个版本的 Chart：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># cat yiran-test/Chart.yaml </span></span><br><span class="line">apiVersion: v1</span><br><span class="line">appVersion: <span class="string">"1.0"</span></span><br><span class="line">description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">name: yiran-test</span><br><span class="line">version: 0.1.0</span><br><span class="line">[root@node1 helm]<span class="comment"># helm package yiran-test</span></span><br><span class="line">Successfully packaged chart and saved it to: /root/helm/yiran-test-0.1.0.tgz</span><br><span class="line">[root@node1 helm]<span class="comment"># vi yiran-test/Chart.yaml </span></span><br><span class="line">[root@node1 helm]<span class="comment"># cat yiran-test/Chart.yaml</span></span><br><span class="line">apiVersion: v2</span><br><span class="line">appVersion: <span class="string">"2.0"</span></span><br><span class="line">description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">name: yiran-test</span><br><span class="line">version: 0.2.0</span><br><span class="line">[root@node1 helm]<span class="comment"># helm package yiran-test</span></span><br><span class="line">Successfully packaged chart and saved it to: /root/helm/yiran-test-0.2.0.tgz</span><br><span class="line">[root@node1 helm]<span class="comment"># ls </span></span><br><span class="line">index.yaml  rbac-config.yaml  yiran-test  yiran-test-0.1.0.tgz  yiran-test-0.2.0.tgz</span><br></pre></td></tr></table></figure>
<p>此时访问浏览器，应该只能看到空的列表，我们更新一下软件源索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm repo index --url=http://192.168.27.231:8879 .</span></span><br><span class="line">[root@node1 helm]<span class="comment"># pwd</span></span><br><span class="line">/root/helm</span><br><span class="line">[root@node1 helm]<span class="comment"># cat index.yaml </span></span><br><span class="line">apiVersion: v1</span><br><span class="line">entries:</span><br><span class="line">  yiran-test:</span><br><span class="line">  - apiVersion: v2</span><br><span class="line">    appVersion: <span class="string">"2.0"</span></span><br><span class="line">    created: <span class="string">"2019-06-21T13:43:41.220764856+08:00"</span></span><br><span class="line">    description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">    digest: af54cfdc5f8e6463a91311496bab8fafd7364c3588b85b5e676fb930cd4e2754</span><br><span class="line">    name: yiran-test</span><br><span class="line">    urls:</span><br><span class="line">    - http://192.168.27.231:8879/yiran-test-0.2.0.tgz</span><br><span class="line">    version: 0.2.0</span><br><span class="line">  - apiVersion: v1</span><br><span class="line">    appVersion: <span class="string">"1.0"</span></span><br><span class="line">    created: <span class="string">"2019-06-21T13:43:41.220059406+08:00"</span></span><br><span class="line">    description: A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">    digest: 64b94c30827aab8e52f57cd3950645bb14ae2deb44e3100d48ecd64f1e706ea5</span><br><span class="line">    name: yiran-test</span><br><span class="line">    urls:</span><br><span class="line">    - http://192.168.27.231:8879/yiran-test-0.1.0.tgz</span><br><span class="line">    version: 0.1.0</span><br><span class="line">generated: <span class="string">"2019-06-21T13:43:41.218753007+08:00"</span></span><br></pre></td></tr></table></figure>
<p>可以看到在 repo 路径下生成了一个 index.yaml 文件，这个文件就是 repo 的索引文件，我们可以直接通过浏览器访问 <code>http://192.168.27.231:8879</code> 来浏览或下载所需软件包。</p>
<p>也可以将本地 repo 添加到 helm 中，使用 helm 命令将软件包部署到 k8s 中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm repo list </span></span><br><span class="line">NAME         	URL                                             </span><br><span class="line">stable       	https://kubernetes-charts.storage.googleapis.com</span><br><span class="line">stable-mirror	https://burdenbear.github.io/kube-charts-mirror/</span><br><span class="line">[root@node1 helm]<span class="comment"># helm repo add local http://192.168.27.231:8879</span></span><br><span class="line"><span class="string">"local"</span> has been added to your repositories</span><br><span class="line">[root@node1 helm]<span class="comment"># helm repo list </span></span><br><span class="line">NAME         	URL                                             </span><br><span class="line">stable       	https://kubernetes-charts.storage.googleapis.com</span><br><span class="line">stable-mirror	https://burdenbear.github.io/kube-charts-mirror/</span><br><span class="line"><span class="built_in">local</span>        	http://192.168.27.231:8879                      </span><br><span class="line">[root@node1 helm]<span class="comment"># helm search yiran</span></span><br><span class="line">NAME            	CHART VERSION	APP VERSION	DESCRIPTION                </span><br><span class="line"><span class="built_in">local</span>/yiran-test	0.2.0        	2.0        	A Helm chart <span class="keyword">for</span> Kubernetes</span><br></pre></td></tr></table></figure>
<p>尝试从本地源安装应用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm list </span></span><br><span class="line">[root@node1 helm]<span class="comment"># helm search yiran</span></span><br><span class="line">NAME            	CHART VERSION	APP VERSION	DESCRIPTION                </span><br><span class="line"><span class="built_in">local</span>/yiran-test	0.2.0        	2.0        	A Helm chart <span class="keyword">for</span> Kubernetes</span><br><span class="line">[root@node1 helm]<span class="comment"># helm install local/yiran-test</span></span><br><span class="line">NAME:   orange-chicken</span><br><span class="line">LAST DEPLOYED: Fri Jun 21 13:49:45 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME                       READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">orange-chicken-yiran-test  0/1    0           0          1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                                        READY  STATUS             RESTARTS  AGE</span><br><span class="line">orange-chicken-yiran-test-7f494c67b5-q9kwp  0/1    ContainerCreating  0         1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                       TYPE       CLUSTER-IP    EXTERNAL-IP  PORT(S)  AGE</span><br><span class="line">orange-chicken-yiran-test  ClusterIP  10.68.85.197  &lt;none&gt;       80/TCP   1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">1. Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">"app.kubernetes.io/name=yiran-test,app.kubernetes.io/instance=orange-chicken"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to use your application"</span></span><br><span class="line">  kubectl port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line"></span><br><span class="line">[root@node1 helm]<span class="comment"># helm list </span></span><br><span class="line">NAME          	REVISION	UPDATED                 	STATUS  	CHART           	APP VERSION	NAMESPACE</span><br><span class="line">orange-chicken	1       	Fri Jun 21 13:49:45 2019	DEPLOYED	yiran-test-0.2.0	2.0        	default </span><br><span class="line">[root@node1 helm]<span class="comment"># kubectl get pod </span></span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">orange-chicken-yiran-test-7f494c67b5-q9kwp   1/1     Running   0          62s</span><br></pre></td></tr></table></figure>
<h4 id="Chart-依赖管理"><a href="#Chart-依赖管理" class="headerlink" title="Chart 依赖管理"></a>Chart 依赖管理</h4><p>包管理器一个比较钟要的功能就是依赖管理，当我安装 A，A 依赖于 B，那么 B 应该会自动安装完成。</p>
<p>我们在 <code>yiran-test</code> 中添加两个依赖，并构建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># cat yiran-test/requirements.yaml   # 添加 apache 和 mysql 依赖</span></span><br><span class="line">dependencies:</span><br><span class="line">  - name: apache</span><br><span class="line">    version: 4.3.2</span><br><span class="line">    repository: https://charts.bitnami.com</span><br><span class="line">  - name: mysql</span><br><span class="line">    version: 1.2.0</span><br><span class="line">    repository: https://burdenbear.github.io/kube-charts-mirror/</span><br><span class="line">[root@node1 helm]<span class="comment"># tree yiran-test/ # 当前目录结构</span></span><br><span class="line">yiran-test/</span><br><span class="line">├── charts</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── requirements.yaml</span><br><span class="line">├── templates</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── <span class="built_in">test</span>-connection.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line">3 directories, 9 files</span><br><span class="line">[root@node1 helm]<span class="comment"># helm dep up yiran-test/ # 下载依赖到本地</span></span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">"local"</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">"stable"</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">"bitnami"</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">"stable-mirror"</span> chart repository</span><br><span class="line">Update Complete.</span><br><span class="line">Saving 2 charts</span><br><span class="line">Downloading apache from repo https://charts.bitnami.com</span><br><span class="line">Downloading mysql from repo https://burdenbear.github.io/kube-charts-mirror/</span><br><span class="line">Deleting outdated charts</span><br><span class="line">[root@node1 helm]<span class="comment"># tree yiran-test/ # 完整目录结构</span></span><br><span class="line">yiran-test/</span><br><span class="line">├── charts</span><br><span class="line">│   ├── apache-4.3.2.tgz</span><br><span class="line">│   └── mysql-1.2.0.tgz</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── requirements.lock</span><br><span class="line">├── requirements.yaml</span><br><span class="line">├── templates</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── <span class="built_in">test</span>-connection.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line">3 directories, 12 files</span><br><span class="line">[root@node1 helm]<span class="comment"># helm package yiran-test</span></span><br><span class="line">Successfully packaged chart and saved it to: /root/helm/yiran-test-0.2.0.tgz</span><br></pre></td></tr></table></figure>
<p>可以看到 helm 对依赖的管理方式是将自己所依赖的所有 Chart，均下载到 <code>yiran-test/charts/</code> 路径下，我们打包的时候其实已经包含了所有依赖了。</p>
<p>再创建一个 Chart，依赖于 <code>yiran-test</code> ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># tree nested/</span></span><br><span class="line">nested/</span><br><span class="line">├── charts</span><br><span class="line">│   └── yiran-test-0.2.0.tgz</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── requirements.lock</span><br><span class="line">├── requirements.yaml</span><br><span class="line">├── templates</span><br><span class="line">│   ├── deployment.yaml</span><br><span class="line">│   ├── _helpers.tpl</span><br><span class="line">│   ├── ingress.yaml</span><br><span class="line">│   ├── NOTES.txt</span><br><span class="line">│   ├── service.yaml</span><br><span class="line">│   └── tests</span><br><span class="line">│       └── <span class="built_in">test</span>-connection.yaml</span><br><span class="line">└── values.yaml</span><br><span class="line"></span><br><span class="line">3 directories, 11 files</span><br><span class="line">[root@node1 helm]<span class="comment"># cat nested/requirements.yaml </span></span><br><span class="line">dependencies:</span><br><span class="line">  - name: yiran-test</span><br><span class="line">    version: 0.2.0</span><br><span class="line">    repository: http://192.168.27.231:8879</span><br></pre></td></tr></table></figure>
<p>实际安装 <code>nested</code> ，来看下安装结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 helm]<span class="comment"># helm install nested/</span></span><br><span class="line">NAME:   alliterating-gopher</span><br><span class="line">LAST DEPLOYED: Fri Jun 21 18:22:52 2019</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/ConfigMap</span><br><span class="line">NAME                            DATA  AGE</span><br><span class="line">alliterating-gopher-mysql-test  1     1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME                            READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">alliterating-gopher-nested      0/1    1           0          1s</span><br><span class="line">alliterating-gopher-yiran-test  0/1    1           0          1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/PersistentVolumeClaim</span><br><span class="line">NAME                       STATUS   VOLUME  CAPACITY  ACCESS MODES  STORAGECLASS  AGE</span><br><span class="line">alliterating-gopher-mysql  Pending  1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                                             READY  STATUS             RESTARTS  AGE</span><br><span class="line">alliterating-gopher-apac-7bf7cc75d5-mhdsg        0/1    ContainerCreating  0         1s</span><br><span class="line">alliterating-gopher-mysql-5db64c59d9-987vm       0/1    Pending            0         1s</span><br><span class="line">alliterating-gopher-nested-6c74d785df-jdqgq      0/1    ContainerCreating  0         1s</span><br><span class="line">alliterating-gopher-yiran-test-67b5cb5599-nfspm  0/1    ContainerCreating  0         1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                       TYPE    DATA  AGE</span><br><span class="line">alliterating-gopher-mysql  Opaque  2     1s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME                            TYPE          CLUSTER-IP     EXTERNAL-IP  PORT(S)                     AGE</span><br><span class="line">alliterating-gopher-apac        LoadBalancer  10.68.35.233   &lt;pending&gt;    80:21195/TCP,443:26200/TCP  1s</span><br><span class="line">alliterating-gopher-mysql       ClusterIP     10.68.70.173   &lt;none&gt;       3306/TCP                    1s</span><br><span class="line">alliterating-gopher-nested      ClusterIP     10.68.190.252  &lt;none&gt;       80/TCP                      1s</span><br><span class="line">alliterating-gopher-yiran-test  ClusterIP     10.68.217.171  &lt;none&gt;       80/TCP                      1s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/Deployment</span><br><span class="line">NAME                       READY  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">alliterating-gopher-apac   0/1    1           0          1s</span><br><span class="line">alliterating-gopher-mysql  0/1    1           0          1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">1. Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace default -l <span class="string">"app.kubernetes.io/name=nested,app.kubernetes.io/instance=alliterating-gopher"</span> -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span>)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to use your application"</span></span><br><span class="line">  kubectl port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line"></span><br><span class="line">[root@node1 helm]<span class="comment"># helm list </span></span><br><span class="line">NAME               	REVISION	UPDATED                 	STATUS  	CHART       	APP VERSION	NAMESPACE</span><br><span class="line">alliterating-gopher	1       	Fri Jun 21 18:22:52 2019	DEPLOYED	nested-0.1.0	1.0        	default  </span><br><span class="line">[root@node1 helm]<span class="comment"># kubectl get pod </span></span><br><span class="line">NAME                                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">alliterating-gopher-apac-7bf7cc75d5-mhdsg         0/1     Running   0          5s</span><br><span class="line">alliterating-gopher-mysql-5db64c59d9-987vm        0/1     Pending   0          5s</span><br><span class="line">alliterating-gopher-nested-6c74d785df-jdqgq       0/1     Running   0          5s</span><br><span class="line">alliterating-gopher-yiran-test-67b5cb5599-nfspm   1/1     Running   0          5s</span><br></pre></td></tr></table></figure>
<p>我们可以看到 nested 已经安装完成了，同时 nested 依赖得 yiran-test 及 yiran-test 依赖得 mysql &amp; apache 也已经安装了。</p>
<p>具体得依赖关系直接引用官方文档示例：</p>
<p>假设名为 “A” 的 chart 创建以下 Kubernetes 对象</p>
<blockquote>
<p>namespace “A-Namespace”<br>statefulset “A-StatefulSet”<br>service “A-Service”  </p>
</blockquote>
<p>此外，A 依赖于创建对象的 chart B.</p>
<blockquote>
<p>namespace “B-Namespace”<br>replicaset “B-ReplicaSet”<br>service “B-Service”  </p>
</blockquote>
<p>安装/升级 chart A 后，会创建/修改单个 Helm 版本。该版本将按以下顺序创建/更新所有上述 Kubernetes 对象：</p>
<blockquote>
<p>A-Namespace<br>B-Namespace<br>A-StatefulSet<br>B-ReplicaSet<br>A-Service<br>B-Service  </p>
</blockquote>
<p>这是因为当 Helm 安装 / 升级 charts 时，charts 中的 Kubernetes 对象及其所有依赖项都是如下</p>
<ol>
<li>聚合成一个单一的集合; </li>
<li>按类型排序，然后按名称排序; </li>
<li>按该顺序创建/更新。</li>
</ol>
<p>因此，单个 release 是使用 charts 及其依赖关系创建的所有对象，这意味着 Helm 不管理依赖服务的相关启动顺序，要由上层应用自己控制（比如创建响应探针）。</p>
<p>具体的资源创建顺序可以看 Tiller <a href="https://github.com/helm/helm/blob/master/pkg/tiller/kind_sorter.go#L29" target="_blank" rel="noopener">相关代码</a>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总体来说 Helm 基础功能使用还是很方便的，关键在于我们如何划分我们应用的粒度，比如 openstack 是以组件为粒度划分的：nova Chart 包含 api、scheduler、conductor 等服务；比如 TiDB Operator 项目是以具体功能来划分的：tidb-backup、tidb-cluster、tidb-operator 。我们应该根据自己的业务需求，合理划分。</p>
<p>还有一点需要注意的是，Helm 项目还处于快速发展阶段（貌似涉及 k8s 的都变化太快），尤其是最近发布了 Helm3 alpha，如果是生产系统，需要考虑后续是否能够平滑升级的影响。</p>
<p>如果实在不喜欢 Helm Tiller 方式，单纯使用 Helm template 也是可以的。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Kubernetes/" rel="tag"># Kubernetes</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/17/调整-arp-参数提高网络稳定性/" rel="next" title="调整 arp 参数提高网络稳定性">
                <i class="fa fa-chevron-left"></i> 调整 arp 参数提高网络稳定性
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/26/Kubernetes-实战-Pod-可用性/" rel="prev" title="Kubernetes 实战-Pod 可用性">
                Kubernetes 实战-Pod 可用性 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/yiran.png" alt="yiran">
            
              <p class="site-author-name" itemprop="name">yiran</p>
              <p class="site-description motion-element" itemprop="description">Normal is boring</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">139</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zdyxry" target="_blank" title="GitHub">
                      GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zdyxry@gmail.com" target="_blank" title="E-Mail">
                      E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/zhouyiran1994" target="_blank" title="Twitter">
                      Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/62229099/" target="_blank" title="Douban">
                      Douban</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://winkidney.com/" title="amao" target="_blank">amao</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jiajunhuang.com/" title="jiajun" target="_blank">jiajun</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://liuliqiang.info/" title="liqiang" target="_blank">liqiang</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本概念"><span class="nav-number">1.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#现状"><span class="nav-number">1.2.</span> <span class="nav-text">现状</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Helm2-基本使用"><span class="nav-number">2.</span> <span class="nav-text">Helm2 基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本使用"><span class="nav-number">2.2.</span> <span class="nav-text">基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Chart构建"><span class="nav-number">2.2.1.</span> <span class="nav-text">Chart构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#升级"><span class="nav-number">2.2.3.</span> <span class="nav-text">升级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#回滚"><span class="nav-number">2.2.4.</span> <span class="nav-text">回滚</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#卸载"><span class="nav-number">2.2.5.</span> <span class="nav-text">卸载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#软件源管理"><span class="nav-number">2.2.6.</span> <span class="nav-text">软件源管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#软件搜索"><span class="nav-number">2.2.7.</span> <span class="nav-text">软件搜索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#打包与本地软件源构建"><span class="nav-number">2.2.8.</span> <span class="nav-text">打包与本地软件源构建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Chart-依赖管理"><span class="nav-number">2.2.9.</span> <span class="nav-text">Chart 依赖管理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yiran</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://zdyxry.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://zdyxry.github.io/2019/06/21/Kubernetes-实战-Helm-包管理器/';
          this.page.identifier = '2019/06/21/Kubernetes-实战-Helm-包管理器/';
          this.page.title = 'Kubernetes 实战-Helm 包管理器';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://zdyxry.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  

















  





  

  

  

  
  

  

  

  

</body>
</html>
